<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate optimal contrasts — optContr • DoseFinding</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate optimal contrasts — optContr"><meta name="description" content="This function calculates a contrast vectors that are optimal for detecting
certain alternatives. The contrast is optimal in the sense of maximizing the
non-centrality parameter of the underlying contrast test statistic:
$$\frac{c'\mu}{\sqrt{c'Sc}}$$ Here \(\mu\) is the
mean vector under the alternative and \(S\) the covariance matrix
associated with the estimate of \(\mu\).  The optimal contrast is
given by $$c^{opt} \propto S^{-1}\left(\mu - \frac{\mu^{\prime}S^{-1}1}
{1^\prime S^{-1} 1}\right),$$
see Pinheiro et al. (2014)."><meta property="og:description" content="This function calculates a contrast vectors that are optimal for detecting
certain alternatives. The contrast is optimal in the sense of maximizing the
non-centrality parameter of the underlying contrast test statistic:
$$\frac{c'\mu}{\sqrt{c'Sc}}$$ Here \(\mu\) is the
mean vector under the alternative and \(S\) the covariance matrix
associated with the estimate of \(\mu\).  The optimal contrast is
given by $$c^{opt} \propto S^{-1}\left(\mu - \frac{\mu^{\prime}S^{-1}1}
{1^\prime S^{-1} 1}\right),$$
see Pinheiro et al. (2014)."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DoseFinding</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/analysis_normal.html">Continuous data MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/binary_data.html">Binary Data MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">MCP-Mod FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/mult_regimen.html">Multiple Regimen MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/overview.html">Overview DoseFinding package</a></li>
    <li><a class="dropdown-item" href="../articles/sample_size.html">Sample size calculations for MCP-Mod</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openpharma/DoseFinding/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Calculate optimal contrasts</h1>
      <small class="dont-index">Source: <a href="https://github.com/openpharma/DoseFinding/blob/master/R/optContr.R" class="external-link"><code>R/optContr.R</code></a></small>
      <div class="d-none name"><code>optContr.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function calculates a contrast vectors that are optimal for detecting
certain alternatives. The contrast is optimal in the sense of maximizing the
non-centrality parameter of the underlying contrast test statistic:
$$\frac{c'\mu}{\sqrt{c'Sc}}$$ Here \(\mu\) is the
mean vector under the alternative and \(S\) the covariance matrix
associated with the estimate of \(\mu\).  The optimal contrast is
given by $$c^{opt} \propto S^{-1}\left(\mu - \frac{\mu^{\prime}S^{-1}1}
{1^\prime S^{-1} 1}\right),$$
see Pinheiro et al. (2014).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">optContr</span><span class="op">(</span></span>
<span>  <span class="va">models</span>,</span>
<span>  <span class="va">doses</span>,</span>
<span>  <span class="va">w</span>,</span>
<span>  <span class="va">S</span>,</span>
<span>  placAdj <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"unconstrained"</span>, <span class="st">"constrained"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'optContr'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  superpose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  xlab <span class="op">=</span> <span class="st">"Dose"</span>,</span>
<span>  ylab <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  plotType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"contrasts"</span>, <span class="st">"means"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plotContr</span><span class="op">(</span><span class="va">optContrObj</span>, xlab <span class="op">=</span> <span class="st">"Dose"</span>, ylab <span class="op">=</span> <span class="st">"Contrast coefficients"</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-models">models<a class="anchor" aria-label="anchor" href="#arg-models"></a></dt>
<dd><p>An object of class <samp>Mods</samp> defining the dose-response
shapes for which to calculate optimal contrasts.</p></dd>


<dt id="arg-doses">doses<a class="anchor" aria-label="anchor" href="#arg-doses"></a></dt>
<dd><p>Optional argument. If this argument is missing the doses
attribute in the <samp>Mods</samp> object specified in <samp>models</samp> is used.</p></dd>


<dt id="arg-w-s">w, S<a class="anchor" aria-label="anchor" href="#arg-w-s"></a></dt>
<dd><p>Arguments determining the matrix S used in the formula for the
optimal contrasts. Exactly one of <samp>w</samp> and <samp>S</samp> has to be specified.
Note that <samp>w</samp> and <samp>S</samp> only have to be specified up to
proportionality <br></p><dl><dt>w</dt>
<dd><p>Vector specifying weights for the
different doses, in the formula for calculation of the optimal contrasts.
Specifying a weights vector is equivalent to specifying S=diag(1/w) (e.g. in
a homoscedastic case with unequal sample sizes, <samp>w</samp> should be
proportional to the group sample sizes).</p></dd>
 <dt>S</dt>
<dd><p>Directly specify a
matrix proportional to the covariance matrix to use.</p></dd>

</dl></dd>


<dt id="arg-placadj">placAdj<a class="anchor" aria-label="anchor" href="#arg-placadj"></a></dt>
<dd><p>Logical determining, whether the contrasts should be applied
to placebo-adjusted estimates. If yes the returned coefficients are no
longer contrasts (i.e. do not sum to 0). However, the result of multiplying
of this "contrast" matrix with the placebo adjusted estimates, will give the
same results as multiplying the original contrast matrix to the unadjusted
estimates.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>For <samp>type = "constrained"</samp> the contrast coefficients of the
zero dose group are constrained to be different from the coefficients of the
active treatment groups. So that a weighted sum of the active treatments is
compared against the zero dose group. For an increasing trend the
coefficient of the zero dose group is negative and all other coefficients
have to be positive (for a decreasing trend the other way round).</p></dd>


<dt id="arg-x-superpose-xlab-ylab-plottype">x, superpose, xlab, ylab, plotType<a class="anchor" aria-label="anchor" href="#arg-x-superpose-xlab-ylab-plottype"></a></dt>
<dd><p>Arguments for the plot method for
optContr objects. plotType determines, whether the contrasts or the
underlying (standardized) mean matrix should be plotted.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments for plot method</p></dd>


<dt id="arg-optcontrobj">optContrObj<a class="anchor" aria-label="anchor" href="#arg-optcontrobj"></a></dt>
<dd><p>For function <samp>plotContr</samp> the <samp>optContrObj</samp>
should contain an object of class <samp>optContr</samp>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Object of class <samp>optContr</samp>. A list containing entries contMat
and muMat (i.e. contrast, mean and correlation matrix).</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Note that the directionality (i.e. whether in "increase" in the response
variable is beneficial or a "decrease", is inferred from the specified
<samp>models</samp> object, see <code><a href="Mods.html">Mods</a></code> for details).</p>
<p>Constrained contrasts (type = "constrained") add the additional constraint
in the optimization that the sign of the contrast coefficient for control
and active treatments need to be different. The quadratic programming
algorithm from the quadprog package is used to calculate the contrasts.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Bretz, F., Pinheiro, J. C., and Branson, M. (2005), Combining
multiple comparisons and modeling techniques in dose-response studies,
<em>Biometrics</em>, <b>61</b>, 738–748</p>
<p>Pinheiro, J. C., Bornkamp, B., Glimm, E. and Bretz, F. (2014) Model-based
dose finding under model uncertainty using general parametric models,
<em>Statistics in Medicine</em>, <b>33</b>, 1646–1661</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="MCTtest.html">MCTtest</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Bjoern Bornkamp</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">doses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span>,<span class="fl">25</span>,<span class="fl">50</span>,<span class="fl">100</span>,<span class="fl">150</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="Mods.html">Mods</a></span><span class="op">(</span>linear <span class="op">=</span> <span class="cn">NULL</span>, emax <span class="op">=</span> <span class="fl">25</span>,</span></span>
<span class="r-in"><span>               logistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">10.88111</span><span class="op">)</span>, exponential<span class="op">=</span> <span class="fl">85</span>,</span></span>
<span class="r-in"><span>               betaMod<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.33</span>,<span class="fl">2.31</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.39</span>,<span class="fl">1.39</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>               doses <span class="op">=</span> <span class="va">doses</span>, addArgs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>scal <span class="op">=</span> <span class="fl">200</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">contMat</span> <span class="op">&lt;-</span> <span class="fu">optContr</span><span class="op">(</span><span class="va">models</span>, w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">contMat</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="optContr-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">plotContr</span><span class="op">(</span><span class="va">contMat</span><span class="op">)</span> <span class="co"># display contrasts using ggplot2</span></span></span>
<span class="r-plt img"><img src="optContr-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## now we would like the "contrasts" for placebo adjusted estimates</span></span></span>
<span class="r-in"><span><span class="va">dosPlac</span> <span class="op">&lt;-</span> <span class="va">doses</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co">## matrix proportional to cov-matrix of plac. adj. estimates for balanced data</span></span></span>
<span class="r-in"><span><span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>,<span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## note that we explicitly hand over the doses here</span></span></span>
<span class="r-in"><span><span class="va">contMat0</span> <span class="op">&lt;-</span> <span class="fu">optContr</span><span class="op">(</span><span class="va">models</span>, doses<span class="op">=</span><span class="va">dosPlac</span>, S <span class="op">=</span> <span class="va">S</span>, placAdj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## -&gt; contMat0 is no longer a contrast matrix (columns do not sum to 0)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">contMat0</span><span class="op">$</span><span class="va">contMat</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      linear        emax    logistic exponential    betaMod1    betaMod2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.4735130   0.9961621   0.4448535   0.3515726   0.6868100   0.6305744 </span>
<span class="r-in"><span><span class="co">## calculate contrast matrix for unadjusted estimates from this matrix</span></span></span>
<span class="r-in"><span><span class="co">## (should be same as above)</span></span></span>
<span class="r-in"><span><span class="va">aux</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">contMat0</span><span class="op">$</span><span class="va">contMat</span><span class="op">)</span>, <span class="va">contMat0</span><span class="op">$</span><span class="va">contMat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">aux</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">aux</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">## compare to contMat$contMat</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          linear        emax    logistic exponential   betaMod1   betaMod2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     -0.42795997 -0.70574595 -0.40645053  -0.3316718 -0.5661425 -0.5333855</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10  -0.35131042 -0.31666702 -0.39242821  -0.3019187  0.3515776 -0.4179871</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25  -0.23633610 -0.02485782 -0.32885490  -0.2501813  0.4607560 -0.1655178</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 50  -0.04471224  0.20210489  0.06107771  -0.1408259  0.3379656  0.2447717</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 100  0.33853550  0.38367506  0.52860594   0.2028509 -0.1207023  0.6273470</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 150  0.72178323  0.46149085  0.53804999   0.8217468 -0.4634544  0.2447717</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## now calculate constrained contrasts </span></span></span>
<span class="r-in"><span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html" class="external-link">requireNamespace</a></span><span class="op">(</span><span class="st">"quadprog"</span>, quietly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span><span class="fu">optContr</span><span class="op">(</span><span class="va">models</span>, w <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">50</span>,<span class="fl">6</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"constrained"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">optContr</span><span class="op">(</span><span class="va">models</span>, doses<span class="op">=</span><span class="va">dosPlac</span>, S <span class="op">=</span> <span class="va">S</span>, placAdj <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>         type <span class="op">=</span> <span class="st">"constrained"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Optimal contrasts</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     linear  emax logistic exponential betaMod1 betaMod2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10   0.000 0.000    0.000           0    0.487    0.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 25   0.000 0.000    0.000           0    0.746    0.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 50   0.000 0.236    0.000           0    0.455    0.197</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 100  0.243 0.604    0.696           0    0.000    0.960</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 150  0.970 0.761    0.718           1    0.000    0.197</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bjoern Bornkamp, Jose Pinheiro, Frank Bretz, Ludger Sandig, Marius Thomas, Novartis Pharma AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

