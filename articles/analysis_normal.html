<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Continuous data MCP-Mod • DoseFinding</title>
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Continuous data MCP-Mod">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DoseFinding</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3-1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/analysis_normal.html">Continuous data MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/binary_data.html">Binary Data MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">MCP-Mod FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/longitudinal_data.html">Longitudinal Data MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/mult_regimen.html">Multiple Regimen MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/overview.html">Overview DoseFinding package</a></li>
    <li><a class="dropdown-item" href="../articles/sample_size.html">Sample size calculations for MCP-Mod</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openpharma/DoseFinding/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Continuous data MCP-Mod</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/DoseFinding/blob/master/vignettes/analysis_normal.Rmd" class="external-link"><code>vignettes/analysis_normal.Rmd</code></a></small>
      <div class="d-none name"><code>analysis_normal.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background-and-data">Background and Data<a class="anchor" aria-label="anchor" href="#background-and-data"></a>
</h2>
<p>In this vignette we will illustrate the usage of the DoseFinding
package for analyzing continuously distributed data. There is a separate
vignette with details on <a href="sample_size.html">sample size and
power calculation</a>.</p>
<p>We will use data from <span class="citation">Verkindre et al. (<a href="#ref-verkindre2010">2010</a>)</span>, who actually use a
cross-over design and utilize MCP-Mod in a supportive analysis. More
information can be found at the corresponding <a href="https://www.clinicaltrials.gov/study/NCT00501852" class="external-link">clinicaltrials.gov
page</a> and on the R help page <code><a href="../reference/glycobrom.html">?glycobrom</a></code>.</p>
<p>The main purpose <span class="citation">Verkindre et al. (<a href="#ref-verkindre2010">2010</a>)</span> was to provide safety and
efficacy data on Glycopyrronium Bromide (NVA237) in patients with stable
Chronic Obstructive Pulmonary Disease (<a href="https://en.wikipedia.org/wiki/Chronic_obstructive_pulmonary_disease" class="external-link">COPD</a>).
The primary endpoint in this study was the mean of two measurements of
forced expiratory volume in 1 second (<a href="https://en.wikipedia.org/wiki/FEV1#Forced_expiratory_volume_in_1_second_(FEV1)" class="external-link">FEV1</a>)
at 23h 15min and 23h 45min post dosing, following 7 days of
treatment.</p>
<p>In order to keep this exposition simple, we will ignore the active
control and focus on the placebo group and the four dose groups (12.5,
25, 50, and 100μg).</p>
<p>For the purpose here, we recreate a dataset that mimicks a parallel
group design, based on the published summary statistics. These can be
found in the <code>glycobrom</code> dataset coming with the
<code>DoseFinding</code> package. Here <code>fev1</code> and
<code>sdev</code> contain the mean and standard deviation of the mean
(standard error) of the primary endpoint for each group, while
<code>n</code> denotes the number of participants.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/openpharma/DoseFinding" class="external-link">DoseFinding</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">glycobrom</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">glycobrom</span><span class="op">)</span></span></code></pre></div>
<pre><code>   dose  fev1   sdev  n
1   0.0 1.243 0.0156 49
2  12.5 1.317 0.0145 55
3  25.0 1.333 0.0151 51
4  50.0 1.374 0.0148 53
5 100.0 1.385 0.0148 53</code></pre>
<p>We want to create a dataset with 60 participants in each of the five
groups. Noticing that the standard errors are essentially equal across
all groups, we draw five vectors of measurement errors centered at
<code>0</code> with identical variances <code>60 * 0.015^2</code> which
we add to the observed means.</p>
<p>Note that here we use <code><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">MASS::mvrnorm</a></code> instead of
<code>rnorm</code> because it lets us generate random numbers with the
specified <em>sample</em> mean and sd.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span>, kind <span class="op">=</span> <span class="st">"Mersenne-Twister"</span>, sample.kind <span class="op">=</span> <span class="st">"Rejection"</span>, normal.kind <span class="op">=</span> <span class="st">"Inversion"</span><span class="op">)</span></span>
<span><span class="va">rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu">MASS</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/MASS/man/mvrnorm.html" class="external-link">mvrnorm</a></span><span class="op">(</span><span class="fl">60</span>, <span class="fl">0</span>, <span class="fl">60</span> <span class="op">*</span> <span class="fl">0.015</span><span class="op">^</span><span class="fl">2</span>, empirical <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">NVA</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>dose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">glycobrom</span><span class="op">$</span><span class="va">dose</span>, each <span class="op">=</span> <span class="fl">60</span><span class="op">)</span>,</span>
<span>                  FEV1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">glycobrom</span><span class="op">$</span><span class="va">fev1</span>, each <span class="op">=</span> <span class="fl">60</span><span class="op">)</span> <span class="op">+</span> <span class="va">rand</span><span class="op">)</span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">NVA</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_jitter</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">dose</span>, <span class="va">FEV1</span><span class="op">)</span>, height <span class="op">=</span> <span class="fl">0</span>, width <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Simulated FEV1 by dose (jittered horizontally)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">xlab</span><span class="op">(</span><span class="st">"dose [μg]"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">ylab</span><span class="op">(</span><span class="st">"FEV1 [l]"</span><span class="op">)</span></span></code></pre></div>
<p><img src="analysis_normal_files/figure-html/simulate_dataset-1.png" width="85%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="design-stage">Design stage<a class="anchor" aria-label="anchor" href="#design-stage"></a>
</h2>
<p>Now let’s forget we already saw the data and imagine we had to design
this trial with MCP-Mod.</p>
<p>First we decide that we want to include two Emax models, one sigmoid
Emax model and one quadratic model in the analysis (see
<code><a href="../reference/drmodels.html">?drmodels</a></code> for other choices). While the (sigmoid) Emax type
covers monotonic dose-response-relationships, the quadratic model is
there to accommodate a potentially decreasing effect at high doses.</p>
<p>Next we have to supply guesstimates for the nonlinear parameters:</p>
<ul>
<li>ED50 for an Emax model</li>
<li>ED50 and the Hill parameter h for a sigmoid emax model</li>
<li>coefficient ratio <span class="math inline">\(\delta =
\beta_2/\lvert\beta_1\rvert\)</span> in the quadratic model <span class="math inline">\(f(d, \theta) = E_0 + \beta_1 d + \beta_2
d^2\)</span>
</li>
</ul>
<p>The following choices cover a range of plausible relationships:</p>
<ul>
<li>ED50 = 2.6 and ED25 = 12.5 for the Emax models (all doses have
substantive effects)</li>
<li>ED50 = 30.5 and h = 3.5 for the sigEmax model (first dose has a
negligible effect)</li>
<li>delta = -0.00776 for the quadratic model (downturn for the fourth
dose)</li>
</ul>
<p>We also fix the effect of placebo at an FEV1 of <code>1.25</code>
liters and the maximum effect at <code>0.15</code> liters above placebo.
This implicitly sets the common linear parameters of all the models.</p>
<p>Note the syntax of the arguments to the <code>Mods</code> function:
<code>emax = c(2.6, 12.5)</code> specifies <em>two</em> Emax models, but
<code>sigEmax = c(30.5, 3.5)</code> only specifies <em>one</em> Sigmoid
Emax model.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">doses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12.5</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">mods</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/Mods.html">Mods</a></span><span class="op">(</span>emax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.6</span>, <span class="fl">12.5</span><span class="op">)</span>, sigEmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30.5</span>, <span class="fl">3.5</span><span class="op">)</span>, quadratic <span class="op">=</span> <span class="op">-</span><span class="fl">0.00776</span>,</span>
<span>             placEff <span class="op">=</span> <span class="fl">1.25</span>, maxEff <span class="op">=</span> <span class="fl">0.15</span>, doses <span class="op">=</span> <span class="va">doses</span><span class="op">)</span></span></code></pre></div>
<p>It’s always a good idea to perform a visual sanity check of the
functional relationships implied by the guesstimates.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/Mods.html">plotMods</a></span><span class="op">(</span><span class="va">mods</span>, ylab <span class="op">=</span> <span class="st">"FEV1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="analysis_normal_files/figure-html/plot_models-1.png" width="85%" style="display: block; margin: auto;"></p>
<p>This concludes the design phase.</p>
<p>We can also take a look at the calculated optimal contrasts. Each
contrast has maximum power to detect a non-flat effect profile in the
hypothetical world where the particular guesstimate is actually the true
value.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">optC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optContr.html">optContr</a></span><span class="op">(</span><span class="va">mods</span>, w<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">optC</span><span class="op">)</span></span></code></pre></div>
<pre><code>Optimal contrasts
      emax1  emax2 sigEmax quadratic
0    -0.886 -0.813  -0.486    -0.723
12.5  0.116 -0.101  -0.439    -0.240
25    0.211  0.136  -0.120     0.140
50    0.265  0.326   0.448     0.587
100   0.294  0.452   0.597     0.236</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">optC</span><span class="op">)</span></span></code></pre></div>
<p><img src="analysis_normal_files/figure-html/contrasts-1.png" width="85%" style="display: block; margin: auto;"></p>
<p>It can be seen that in the balanced sample size case and equal
variance assumed for each dose group, the optimal contrasts reflect the
underlying assumed mean dose-response shape. This is no surprise, given
that the optimal contrasts are given by <span class="math display">\[
c^{\textrm{opt}} \propto
S^{-1}\biggl(\mu^0_m - \frac{(\mu^0_m)^T S^{-1}1_K}{1_K^T S^{-1}
1_K}\biggr)
\]</span> where <span class="math inline">\(\mu^0_m\)</span> is the
standardized mean response, <span class="math inline">\(K\)</span> is
the number doses, and <span class="math inline">\(1_K\)</span> is an
all-ones vector of length <span class="math inline">\(K\)</span> and
<span class="math inline">\(S\)</span> is the covariance matrix of the
estimates at the doses <span class="citation">(see <a href="#ref-pinheiro2014">Pinheiro et al. 2014</a> for a detailed
account)</span>. As we have equal variance in all dose groups in our
case and no correlation, the optimal contrasts are all proportional to
the shapes of the candidate model mean vectors. As the standardized
model is used in the formula, the values of the linear parameters of the
models do not impact the optimal contrasts.</p>
</div>
<div class="section level2">
<h2 id="analysis-stage">Analysis stage<a class="anchor" aria-label="anchor" href="#analysis-stage"></a>
</h2>
<p>Now fast-forward to the time when we have collected the data.</p>
<div class="section level3">
<h3 id="multiple-comparisons">Multiple comparisons<a class="anchor" aria-label="anchor" href="#multiple-comparisons"></a>
</h3>
<p>We run the multiple contrast test with the pre-specified models. Note
that the <code>type</code> parameter defaults to
<code>type="normal"</code>, which means that we assume a homoscedastic
ANOVA model for <code>FEV1</code>, i.e. critical values are taken from a
multivariate t distribution. Further note that when <code>data</code> is
supplied, the first two arguments <code>dose</code> and
<code>FEV1</code> are <em>not evaluated</em>, but symbolically refer to
the columns in <code>data=NVA</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_normal</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MCTtest.html">MCTtest</a></span><span class="op">(</span>dose <span class="op">=</span> <span class="va">dose</span>, resp <span class="op">=</span> <span class="va">FEV1</span>, models <span class="op">=</span> <span class="va">mods</span>, data <span class="op">=</span> <span class="va">NVA</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">test_normal</span><span class="op">)</span></span></code></pre></div>
<pre><code>Multiple Contrast Test

Contrasts:
      emax1  emax2 sigEmax quadratic
0    -0.886 -0.813  -0.486    -0.723
12.5  0.116 -0.101  -0.439    -0.240
25    0.211  0.136  -0.120     0.140
50    0.265  0.326   0.448     0.587
100   0.294  0.452   0.597     0.236

Contrast Correlation:
          emax1 emax2 sigEmax quadratic
emax1     1.000 0.957   0.648     0.867
emax2     0.957 1.000   0.839     0.929
sigEmax   0.648 0.839   1.000     0.844
quadratic 0.867 0.929   0.844     1.000

Multiple Contrast Test:
          t-Stat  adj-p
emax2      7.443 &lt;0.001
quadratic  7.016 &lt;0.001
emax1      6.937 &lt;0.001
sigEmax    6.676 &lt;0.001</code></pre>
<p>The test results suggest a clear dose-response trend.</p>
<p>Alternatively we can use generalized MCP-Mod (see the FAQ for the <a href="faq.html">difference</a>). We use R’s builtin <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code>
function to manually fit the ANOVA model and extract estimates for the
model coefficients and their covariance matrix. We also need the model
degrees of freedom.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitlm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">FEV1</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">NVA</span><span class="op">)</span></span>
<span><span class="va">mu_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fitlm</span><span class="op">)</span></span>
<span><span class="va">S_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">fitlm</span><span class="op">)</span></span>
<span><span class="va">anova_df</span> <span class="op">&lt;-</span> <span class="va">fitlm</span><span class="op">$</span><span class="va">df.residual</span></span></code></pre></div>
<p>Next we supply them to the <code>MCTtest</code> function together
with <code>type="general"</code>. Note that in contrast to the
invocation above we here supply the <code>doses</code> and the estimates
<code>mu_hat</code> and <code>S_hat</code> directly and not within a
<code>data.frame</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_general</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/MCTtest.html">MCTtest</a></span><span class="op">(</span>dose <span class="op">=</span> <span class="va">doses</span>, resp <span class="op">=</span> <span class="va">mu_hat</span>, S <span class="op">=</span> <span class="va">S_hat</span>, df <span class="op">=</span> <span class="va">anova_df</span>,</span>
<span>                        models <span class="op">=</span> <span class="va">mods</span>, type <span class="op">=</span> <span class="st">"general"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">test_general</span><span class="op">)</span></span></code></pre></div>
<pre><code>Multiple Contrast Test

Contrasts:
      emax1  emax2 sigEmax quadratic
0    -0.886 -0.813  -0.486    -0.723
12.5  0.116 -0.101  -0.439    -0.240
25    0.211  0.136  -0.120     0.140
50    0.265  0.326   0.448     0.587
100   0.294  0.452   0.597     0.236

Contrast Correlation:
          emax1 emax2 sigEmax quadratic
emax1     1.000 0.957   0.648     0.867
emax2     0.957 1.000   0.839     0.929
sigEmax   0.648 0.839   1.000     0.844
quadratic 0.867 0.929   0.844     1.000

Multiple Contrast Test:
          t-Stat  adj-p
emax2      7.443 &lt;0.001
quadratic  7.016 &lt;0.001
emax1      6.937 &lt;0.001
sigEmax    6.676 &lt;0.001</code></pre>
<p>For the simple ANOVA case at hand the results of the original and the
generalized MCP-Mod approaches actually coincide. The p-values differ
due to the numerical methods used for obtaining them.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>normal <span class="op">=</span> <span class="va">test_normal</span><span class="op">$</span><span class="va">tStat</span>, generalized <span class="op">=</span> <span class="va">test_general</span><span class="op">$</span><span class="va">tStat</span><span class="op">)</span></span></code></pre></div>
<pre><code>            normal generalized
emax1     6.937000    6.937000
emax2     7.442849    7.442849
sigEmax   6.675739    6.675739
quadratic 7.016303    7.016303</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>normal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">test_normal</span><span class="op">$</span><span class="va">tStat</span>, <span class="st">"pVal"</span><span class="op">)</span>, generalized <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">test_general</span><span class="op">$</span><span class="va">tStat</span>, <span class="st">"pVal"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>           normal  generalized
[1,] 1.221279e-11 1.224099e-11
[2,] 5.375700e-13 6.030731e-13
[3,] 5.924716e-11 6.039769e-11
[4,] 8.166245e-12 7.672307e-12</code></pre>
</div>
</div>
<div class="section level2">
<h2 id="dose-response-estimation">Dose-response estimation<a class="anchor" aria-label="anchor" href="#dose-response-estimation"></a>
</h2>
<p>In the simplest case we would now proceed to fit only a single model
type, for example the one with the largest t-statistic (or alternatively
smallest AIC or BIC):</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_single</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitMod.html">fitMod</a></span><span class="op">(</span><span class="va">dose</span>, <span class="va">FEV1</span>, <span class="va">NVA</span>, model <span class="op">=</span> <span class="st">"emax"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit_single</span><span class="op">)</span></span></code></pre></div>
<p><img src="analysis_normal_files/figure-html/fit_single-1.png" width="85%" style="display: block; margin: auto;"></p>
<p>But actually we want to use a more robust approach that combines
bootstrapping with model averaging in the generalized MCP-Mod
framework.</p>
<p>First we draw bootstrap samples from the multivariate normal
distribution of the estimates originating from the first-stage model.
Next, for each bootstrapped data set we fit our candidate models, select
the one with lowest AIC and save the corresponding estimated quantities
of interest. This selection step implies that the bootstrap samples
potentially come from different models. Finally we use these
bootstrapped estimates for inference. For example, we can estimate a
dose-response curve by using the median over the bootstrapped means at
each dose. Similarly we can derive confidence intervals based on
bootstrap quantiles. Inference for other quantities of interest can be
performed in an analogous way.</p>
<p>As different models contribute to the bootstrap resamples, the
approach can be considered more robust than simple model selection <span class="citation">(see also <a href="#ref-schorning2016">Schorning et al.
2016</a> for simulations on this topic)</span>.</p>
<p>Now let’s apply this general idea to the case at hand. Our
first-stage model is an ANOVA, and we’re interested in an estimate of
the dose-response curve plus confidence intervals. Our set of candidate
model types consists of Emax, sigEmax and quadratic.</p>
<p>We us R’s builtin <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> function to fit an ANOVA model
without intercept and extract estimates for the model coefficients and
their covariance matrix.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitlm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">FEV1</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span>, data <span class="op">=</span> <span class="va">NVA</span><span class="op">)</span></span>
<span><span class="va">dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">NVA</span><span class="op">$</span><span class="va">dose</span><span class="op">)</span></span>
<span><span class="va">mu_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fitlm</span><span class="op">)</span></span>
<span><span class="va">S_hat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">fitlm</span><span class="op">)</span></span></code></pre></div>
<p>The bootstrap procedure described above is implemented in the
<code>maFitMod</code> function. Note that for technical reasons we have
to supply boundaries to the fitting algorithm via the <code>bnds</code>
argument to <code>maFitMod</code> (see <code><a href="../reference/fitMod.html">?fitMod</a></code> and
<code><a href="../reference/defBnds.html">?defBnds</a></code> for details).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_mod_av</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/maFitMod.html">maFitMod</a></span><span class="op">(</span><span class="va">dose</span>, <span class="va">mu_hat</span>, S <span class="op">=</span> <span class="va">S_hat</span>,</span>
<span>                       models <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"emax"</span>, <span class="st">"sigEmax"</span>, <span class="st">"quadratic"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>With the <code>predict</code> method we can obtain the predictions
from the fitted model on each boostrap sample. The <code>plot</code>
method allows to summarize the model fits (some limited customization is
possible see <code><a href="../reference/maFitMod.html">?plot.maFit</a></code>).</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># point estimates (median) and bootstrap quantile intervals can be extracted via</span></span>
<span><span class="va">ma_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit_mod_av</span>, doseSeq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12.5</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># individual bootstrap estimates via</span></span>
<span><span class="va">indiv_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit_mod_av</span>, doseSeq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12.5</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span>,</span>
<span>                      summaryFct <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co"># plotting can be done via</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit_mod_av</span>, plotData <span class="op">=</span> <span class="st">"meansCI"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Model averaging estimate with 95% CI"</span><span class="op">)</span></span></code></pre></div>
<p><img src="analysis_normal_files/figure-html/bootstrap_summarize-1.png" width="85%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="how-to-adjust-for-covariates">How to adjust for covariates?<a class="anchor" aria-label="anchor" href="#how-to-adjust-for-covariates"></a>
</h2>
<p>In all practical situations covariates will be used to adjust for in
the analysis. The MCP step can then be performed for example by
including the covariates in the <code>addCovars</code> argument. Another
approach to perform the MCP step is based on the differences to placebo:
In a first stage <code>lm(.)</code> is fit <em>with</em> an intercept
included. Then the treatment differences and corresponding covariance
matrix would be extracted. This could then be fed into the
<code>MCTtest</code> function, with the <code>placAdj = TRUE</code>
argument, see <code><a href="../reference/MCTtest.html">?MCTtest</a></code> for an example. Both approaches will
give the same result.</p>
<p>A third alternative is to calculate the adjusted means (and
corresponding covariance matrix) and then perform generalized MCP-Mod
based on these estimates (following the same steps as in the unadjusted
analysis above, but adding the <code>type = "general"</code> argument as
well as the estimated covariance matrix via <code>S</code>). The
procedure is very similar to the situation explained in detail in the
vignette for the <a href="binary_data.html">analysis of binary data</a>,
so not repeated here.</p>
<p>For the case of normally distributed data adjusted means are
calculated by predicting the outcome (using the covariate adjusted
model) of each patient in the study under every dose, and then averaging
over all patients per dose.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-pinheiro2014" class="csl-entry">
Pinheiro, J., Bornkamp, B., Glimm, E., and Bretz, F. (2014),
<span>“Model-based dose finding under model uncertainty using general
parametric models,”</span> <em>Statistics in Medicine</em>, 33,
1646–1661. <a href="https://doi.org/10.1002/sim.6052" class="external-link">https://doi.org/10.1002/sim.6052</a>.
</div>
<div id="ref-schorning2016" class="csl-entry">
Schorning, K., Bornkamp, B., Bretz, F., and Dette, H. (2016),
<span>“Model selection versus model averaging in dose finding
studies,”</span> <em>Statistics in Medicine</em>, 35, 4021–4040. <a href="https://doi.org/10.1002/sim.6991" class="external-link">https://doi.org/10.1002/sim.6991</a>.
</div>
<div id="ref-verkindre2010" class="csl-entry">
Verkindre, C., Fukuchi, Y., Flémale, A., Takeda, A., Overend, T.,
Prasad, N., and Dolker, M. (2010), <span>“Sustained 24-h efficacy of
NVA237, a once-daily long-acting muscarinic antagonist, in COPD
patients,”</span> <em>Respiratory Medicine</em>, 104, 1482–1489. <a href="https://doi.org/10.1016/j.rmed.2010.04.006" class="external-link">https://doi.org/10.1016/j.rmed.2010.04.006</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bjoern Bornkamp, Jose Pinheiro, Frank Bretz, Ludger Sandig, Marius Thomas, Novartis Pharma AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
