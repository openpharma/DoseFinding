<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Sample size calculations for MCP-Mod • DoseFinding</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Sample size calculations for MCP-Mod">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DoseFinding</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3-1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/analysis_normal.html">Continuous data MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/binary_data.html">Binary Data MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">MCP-Mod FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/mult_regimen.html">Multiple Regimen MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/overview.html">Overview DoseFinding package</a></li>
    <li><a class="dropdown-item" href="../articles/sample_size.html">Sample size calculations for MCP-Mod</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openpharma/DoseFinding/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Sample size calculations for MCP-Mod</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/openpharma/DoseFinding/blob/master/vignettes/sample_size.Rmd" class="external-link"><code>vignettes/sample_size.Rmd</code></a></small>
      <div class="d-none name"><code>sample_size.Rmd</code></div>
    </div>

    
    
<p>In this vignette we will take a closer look at the design stage and
see how to perform power and sample size calculations for MCP-Mod with
the DoseFinding package.</p>
<p>We will consider the same example study and the same candidate models
as in the <a href="analysis_normal.html">vignette for analysis of
normally distributed data</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/openpharma/DoseFinding" class="external-link">DoseFinding</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">doses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">12.5</span>, <span class="fl">25</span>, <span class="fl">50</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">guess</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>emax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.6</span>, <span class="fl">12.5</span><span class="op">)</span>, sigEmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30.5</span>, <span class="fl">3.5</span><span class="op">)</span>, quadratic <span class="op">=</span> <span class="op">-</span><span class="fl">0.00776</span><span class="op">)</span></span>
<span><span class="va">mods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">Mods</span>, <span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="va">guess</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>placEff <span class="op">=</span> <span class="fl">1.25</span>, maxEff <span class="op">=</span> <span class="fl">0.15</span>, doses <span class="op">=</span> <span class="va">doses</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/Mods.html">plotMods</a></span><span class="op">(</span><span class="va">mods</span><span class="op">)</span></span></code></pre></div>
<p><img src="sample_size_files/figure-html/setup-1.png" width="50%" style="display: block; margin: auto;"></p>
<div class="section level2">
<h2 id="power-for-multiple-contrast-test-versus-group-sample-size">Power for multiple contrast test versus group sample size<a class="anchor" aria-label="anchor" href="#power-for-multiple-contrast-test-versus-group-sample-size"></a>
</h2>
<p>In this section we will investigate at how power varies with sample
size. Note that the maximum effect size within the dose-range is fixed
through <code>maxEff</code> in the candidate models.</p>
<p>First we calculate the matrix of optimal contrasts (<code>w=1</code>
denotes homoscedastic residuals with equal group sizes, see
<code><a href="../reference/optContr.html">?optContr</a></code>).</p>
<p>In <code>powN</code> we specify the sample sizes for which to
calculate the power. We request five equally sized groups with
<code>alRatio = rep(1, 5)</code>. We fix the residual standard deviation
with <code>sigma = 0.34</code>, and calculate the power for a one-sided
test at level 0.05.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optContr.html">optContr</a></span><span class="op">(</span><span class="va">mods</span>, w<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">pows</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sampSize.html">powN</a></span><span class="op">(</span>upperN <span class="op">=</span> <span class="fl">100</span>, lowerN <span class="op">=</span> <span class="fl">10</span>, step <span class="op">=</span> <span class="fl">10</span>, contMat <span class="op">=</span> <span class="va">contMat</span>,</span>
<span>             sigma <span class="op">=</span> <span class="fl">0.34</span>, altModels <span class="op">=</span> <span class="va">mods</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, alRatio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pows</span><span class="op">)</span></span></code></pre></div>
<p><img src="sample_size_files/figure-html/power_sample_size_1-1.png" width="85%" style="display: block; margin: auto;">
This shows the power values of the maximum contrast test assuming each
of the different candidate models to be true. The minimum, mean and
maximum power over the candidate models are also included in the
plot.</p>
<p>There also is a wrapper function that calculates the group sample
sizes needed in order to attain a specific power. The powers under each
alternative model are combined with <code>sumFct</code>. Here we look at
the minimum power, other potential choices are <code>mean</code> or
<code>max</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/sampSize.html">sampSizeMCT</a></span><span class="op">(</span>upperN <span class="op">=</span> <span class="fl">150</span>, contMat <span class="op">=</span> <span class="va">contMat</span>, sigma <span class="op">=</span> <span class="fl">0.34</span>, altModels <span class="op">=</span> <span class="va">mods</span>,</span>
<span>            power <span class="op">=</span> <span class="fl">0.9</span>, alRatio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.05</span>, sumFct <span class="op">=</span> <span class="va">min</span><span class="op">)</span></span></code></pre></div>
<pre><code>Sample size calculation

alRatio: 1 1 1 1 1 
Total sample size: 465 
Sample size per arm: 93 93 93 93 93 
targFunc: 0.9014 </code></pre>
</div>
<div class="section level2">
<h2 id="power-versus-treatment-effect">Power versus treatment effect<a class="anchor" aria-label="anchor" href="#power-versus-treatment-effect"></a>
</h2>
<p>In this section we fix the group sample size at 90 and vary the
treatment Effect <code>maxEff</code>. Note how power decreases if we
assume a higher residual standard deviation.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_power_vs_treatment_effect</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">guess</span>, <span class="va">doses</span>, <span class="va">group_size</span>, <span class="va">placEff</span>, <span class="va">maxEffs</span>,</span>
<span>                                           <span class="va">sigma_low</span>, <span class="va">sigma_mid</span>, <span class="va">sigma_high</span>, <span class="va">alpha</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mods_args_fixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="va">guess</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>placEff <span class="op">=</span> <span class="va">placEff</span>, doses <span class="op">=</span> <span class="va">doses</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">grd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>max_eff <span class="op">=</span> <span class="va">maxEffs</span>, sigma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sigma_low</span>, <span class="va">sigma_mid</span>, <span class="va">sigma_high</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">min_power</span> <span class="op">&lt;-</span> <span class="va">mean_power</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">grd</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">mods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">Mods</span>, <span class="fu"><a href="https://rdrr.io/r/base/append.html" class="external-link">append</a></span><span class="op">(</span><span class="va">mods_args_fixed</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>maxEff <span class="op">=</span> <span class="va">grd</span><span class="op">$</span><span class="va">max_eff</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/powMCT.html">powMCT</a></span><span class="op">(</span><span class="fu"><a href="../reference/optContr.html">optContr</a></span><span class="op">(</span><span class="va">mods</span>, w <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>, <span class="va">alpha</span>, <span class="va">mods</span>, <span class="va">group_size</span>, <span class="va">grd</span><span class="op">$</span><span class="va">sigma</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">min_power</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span>    <span class="va">mean_power</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">grd</span><span class="op">$</span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">grd</span><span class="op">$</span><span class="va">sigma</span><span class="op">)</span></span>
<span>  <span class="va">pdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">grd</span>, power <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">min_power</span>, <span class="va">mean_power</span><span class="op">)</span>,</span>
<span>                sumFct <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min"</span>, <span class="st">"mean"</span><span class="op">)</span><span class="op">)</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">grd</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">subt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"group size = %d, α = %.3f"</span>, <span class="va">group_size</span>, <span class="va">alpha</span><span class="op">)</span></span>
<span>  <span class="va">gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pdat</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">max_eff</span>, <span class="va">power</span>, lty <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">sumFct</span>, labeller <span class="op">=</span> <span class="va">label_both</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"maximum treatment effect"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"power"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Minimum power vs effect size for different residual standard deviations"</span>, subtitle <span class="op">=</span> <span class="va">subt</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,by<span class="op">=</span><span class="fl">.1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">gg</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">plot_power_vs_treatment_effect</span><span class="op">(</span><span class="va">guess</span>, <span class="va">doses</span>, group_size <span class="op">=</span> <span class="fl">90</span>, placEff <span class="op">=</span> <span class="fl">1.25</span>,</span>
<span>                               maxEffs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.3</span>, length.out <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>                               sigma_low <span class="op">=</span> <span class="fl">0.3</span>, sigma_mid <span class="op">=</span> <span class="fl">0.34</span>, sigma_high <span class="op">=</span> <span class="fl">0.4</span>, alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></code></pre></div>
<p><img src="sample_size_files/figure-html/power_effect_size-1.png" width="85%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="power-under-mis-specification">Power under mis-specification<a class="anchor" aria-label="anchor" href="#power-under-mis-specification"></a>
</h2>
<p>MCP-Mod depends on the candidate models selected. What if the true
model is not among the chosen candidate shapes? Often MCP-Mod is rather
robust. To illustrate this, let’s assume an exponential model shape is
the true model, which is not among the candidate shapes. Let this
exponential model have small responses for all doses but the last (here
assuming 20% of the overall treatment effect is achieved at the 50μg
dose). All other candidate shapes assume that almost the full effect is
achieved for the 50μg dose, so this shape is quite different from all
other shapes included in the candidate set.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">guess_miss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>exponential <span class="op">=</span> <span class="fu"><a href="../reference/guesst.html">guesst</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">0.2</span>, <span class="st">"exponential"</span>, Maxd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">doses</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mods_miss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">Mods</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">guess</span>, <span class="va">guess_miss</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>placEff <span class="op">=</span> <span class="fl">1.25</span>, maxEff <span class="op">=</span> <span class="fl">0.15</span>, doses <span class="op">=</span> <span class="va">doses</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mods_miss</span>, superpose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="sample_size_files/figure-html/power_miss_1-1.png" width="85%" style="display: block; margin: auto;"></p>
<p>Now we compare the power calculation under the exponential model with
those based on the original candidate set, in both cases only the
contrasts from the original candidate set are used.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_power_misspec</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">guess</span>, <span class="va">guess_miss</span>, <span class="va">placEff</span>, <span class="va">maxEff</span>, <span class="va">doses</span>,</span>
<span>                               <span class="va">upperN</span>, <span class="va">lowerN</span>, <span class="va">step</span>, <span class="va">sigma</span>, <span class="va">alpha</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">mods_extra_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>placEff <span class="op">=</span> <span class="va">placEff</span>, maxEff <span class="op">=</span> <span class="va">maxEff</span>, doses <span class="op">=</span> <span class="va">doses</span><span class="op">)</span></span>
<span>  <span class="va">pown_extra_par</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>upperN <span class="op">=</span> <span class="va">upperN</span>, lowerN <span class="op">=</span> <span class="va">lowerN</span>, step <span class="op">=</span> <span class="va">step</span>,</span>
<span>                         sigma <span class="op">=</span> <span class="va">sigma</span>, alpha <span class="op">=</span> <span class="va">alpha</span>, alRatio <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">doses</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">mods_miss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">Mods</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">guess_miss</span>, <span class="va">mods_extra_par</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">mods_ok</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">Mods</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">guess</span>, <span class="va">mods_extra_par</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">cm_ok</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optContr.html">optContr</a></span><span class="op">(</span><span class="va">mods_ok</span>, w <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">p_miss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">powN</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pown_extra_par</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>contMat <span class="op">=</span> <span class="va">cm_ok</span>, altModels <span class="op">=</span> <span class="va">mods_miss</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">p_ok</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">powN</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pown_extra_par</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>contMat <span class="op">=</span> <span class="va">cm_ok</span>, altModels <span class="op">=</span> <span class="va">mods_ok</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">pwr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">p_ok</span><span class="op">)</span><span class="op">)</span>, <span class="va">p_ok</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min"</span>, <span class="st">"mean"</span><span class="op">)</span><span class="op">]</span>, miss <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>               <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">p_miss</span><span class="op">)</span><span class="op">)</span>, <span class="va">p_miss</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min"</span>, <span class="st">"mean"</span><span class="op">)</span><span class="op">]</span>, miss <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">pwr</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>group <span class="op">=</span> <span class="va">miss</span>, color <span class="op">=</span> <span class="va">miss</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">min</span>, linetype <span class="op">=</span> <span class="st">"minimum"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">mean</span>, linetype <span class="op">=</span> <span class="st">"mean"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"miss-specified"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_linetype.html" class="external-link">scale_linetype_discrete</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"aggregation"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Mean and minimum power under mis-specification"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"group size"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"power"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,by<span class="op">=</span><span class="fl">.1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">gg</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">plot_power_misspec</span><span class="op">(</span><span class="va">guess</span>, <span class="va">guess_miss</span>, placEff <span class="op">=</span> <span class="fl">1.25</span>, maxEff <span class="op">=</span> <span class="fl">0.15</span>, doses <span class="op">=</span> <span class="va">doses</span>,</span>
<span>                   upperN <span class="op">=</span> <span class="fl">100</span>, lowerN <span class="op">=</span> <span class="fl">10</span>, step <span class="op">=</span> <span class="fl">10</span>, sigma <span class="op">=</span> <span class="fl">0.34</span>, alpha <span class="op">=</span> <span class="fl">0.05</span><span class="op">)</span></span></code></pre></div>
<p><img src="sample_size_files/figure-html/power_miss_2-1.png" width="85%" style="display: block; margin: auto;"></p>
<p>As expected, the power decreases as the assumed underlying
exponential model shape differs substantially from the shapes included
in the candidate set. However, the power loss is only in the range of
10-15%.</p>
</div>
<div class="section level2">
<h2 id="sample-size-based-on-metrics-other-than-power-for-the-multiple-contrast-test">Sample size based on metrics other than power for the multiple
contrast test<a class="anchor" aria-label="anchor" href="#sample-size-based-on-metrics-other-than-power-for-the-multiple-contrast-test"></a>
</h2>
<p>The main purpose of a dose-finding study is selection of a dose to
take forward into Phase 3. Establishment of a trend over placebo is
hence only a minimum requirement before considering dose-selection.</p>
<p>If one considers sample size calculation to allow for adequate dose
selection (see <code><a href="../reference/targdose.html">?TD</a></code>) it turns out that this is a much harder
problem than establishing a dose-response effect versus placebo based on
the MCP-part: The sample size required for adequate accuracy in
estimation of a target dose (e.g. the smallest dose achieving a relevant
improvement over placebo) is usually several-fold higher than the sample
size needed to have adequate power for the MCP-part. This should not
come as a surprise as dose-estimation is primarily a comparison among
the investigational doses, while the MCP-part establishes an effect
versus placebo. Chapter 12 in <span class="citation">O’Quigley, Iasonos,
and Bornkamp (2017)</span> illustrates this with simulations, based on
the <code>planMod</code> function (see <code><a href="../reference/planMod.html">?planMod</a></code> for example
usage).</p>
<p>Here we only consider a brief example: Consider the
<code>sigEmax(30.5, 3.5)</code> model from the first section and assume
that it is the “true model” under which we want to investigate the
operating characteristics of fitting sigEmax models. Suppose we want to
achieve a target improvement of <span class="math inline">\(\Delta=0.12
L\)</span> over placebo. One can calculate that this needs a target dose
TD of 44.4 mg under the true model. Keep this number in mind for later.
Now we can ask the question what the variability in TD estimation would
be. To answer it, we can run a simulation using the <code>planMod</code>
function. If we use the sample size n=93 from the power calculation
above, we find:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span><span class="co">## Note: Warnings related to vcov.DRMod can be ignored if small relative to the total number of simulations</span></span>
<span><span class="va">pm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/planMod.html">planMod</a></span><span class="op">(</span><span class="st">"sigEmax"</span>, <span class="fu"><a href="../reference/Mods.html">Mods</a></span><span class="op">(</span>sigEmax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30.5</span>, <span class="fl">3.5</span><span class="op">)</span>, placEff<span class="op">=</span><span class="fl">1.25</span>, maxEff<span class="op">=</span><span class="fl">0.15</span>, doses<span class="op">=</span><span class="va">doses</span><span class="op">)</span>,</span>
<span>              n<span class="op">=</span><span class="fl">93</span>, sigma <span class="op">=</span> <span class="fl">0.34</span>, doses<span class="op">=</span><span class="va">doses</span>, simulation<span class="op">=</span><span class="cn">TRUE</span>, nSim<span class="op">=</span><span class="fl">5000</span>, showSimProgress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              bnds <span class="op">=</span> <span class="fu"><a href="../reference/defBnds.html">defBnds</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">doses</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>Running simulations</code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pm</span>,  Delta<span class="op">=</span><span class="fl">0.12</span><span class="op">)</span></span></code></pre></div>
<pre><code>Additional simulation metrics (nSim=5000)
        Eff-vs-ANOVA  cRMSE lengthTDCI P(no TD) lengthEDCI
sigEmax         1.65 0.0392       62.3    0.153         NA</code></pre>
<p>The output shows different outputs (see <code><a href="../reference/planMod.html">?planMod</a></code> for
details) of most interest here is the length of the quantile range for a
target dose (<code>lengthTDCI</code>). By default this is calculated by
taking the difference of 5% and 95% quantile of the empirical
distribution of the dose estimates in the simulation. The metric
<code>P(no TD)</code> indicates in how many simulations runs no TD could
be identified.</p>
<p>From the output it can be seen that the variation in the TD estimates
is quite large and quite unsatisfactory. Experimenting with different
values of <code>n</code>, one quickly realizes that we would need for
example 1650 patients to get the length of this interval down to 20
mg.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/planMod.html">planMod</a></span><span class="op">(</span><span class="st">"sigEmax"</span>, <span class="fu"><a href="../reference/Mods.html">Mods</a></span><span class="op">(</span>sigEmax<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30.5</span>, <span class="fl">3.5</span><span class="op">)</span>, placEff<span class="op">=</span><span class="fl">1.25</span>, maxEff<span class="op">=</span><span class="fl">0.15</span>, doses<span class="op">=</span><span class="va">doses</span><span class="op">)</span>,</span>
<span>              n<span class="op">=</span><span class="fl">1650</span>, sigma <span class="op">=</span> <span class="fl">0.34</span>, doses<span class="op">=</span><span class="va">doses</span>, simulation<span class="op">=</span><span class="cn">TRUE</span>, nSim<span class="op">=</span><span class="fl">5000</span>, showSimProgress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>              bnds <span class="op">=</span> <span class="fu"><a href="../reference/defBnds.html">defBnds</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">doses</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>Running simulations</code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pm</span>, Delta<span class="op">=</span><span class="fl">0.12</span><span class="op">)</span></span></code></pre></div>
<pre><code>Additional simulation metrics (nSim=5000)
        Eff-vs-ANOVA  cRMSE lengthTDCI P(no TD) lengthEDCI
sigEmax          1.4 0.0102       20.2   0.0034         NA</code></pre>
<p>Note that the variability in TD estimation depends quite strongly on
the assumed true dose-response model, see the simulation results in
Chapter 12 in <span class="citation">O’Quigley, Iasonos, and Bornkamp
(2017)</span>.</p>
<p>In practice, to keep the size of the study feasible, one needs to
find a compromise between dose-response signal detection and estimation
precision as the criteria for sample size determination. Irrespective,
it is important to properly evaluate the operating characteristics of a
given design (including sample size) to understand its strengths and
limitations.</p>
<p>In practice of course the dose-response curve of the main efficacy
endpoint, is not the only consideration in dose-selection for Phase III:
Results for other efficacy/biomarker endpoints, but also the results for
tolerability or safety markers, will contribute to that decision.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-oquigley2017" class="csl-entry">
O’Quigley, John, Alexia Iasonos, and Björn Bornkamp. 2017. <em>Handbook
of Methods for Designing, Monitoring, and Analyzing Dose-Finding
Trials</em>. CRC Press. <a href="https://doi.org/10.1201/9781315151984" class="external-link">https://doi.org/10.1201/9781315151984</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bjoern Bornkamp, Jose Pinheiro, Frank Bretz, Ludger Sandig, Marius Thomas, Novartis Pharma AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
