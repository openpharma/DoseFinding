<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit non-linear dose-response model — fitMod • DoseFinding</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit non-linear dose-response model — fitMod"><meta name="description" content='Fits a dose-response model. Built-in dose-response models are "linlog", "linear", "quadratic", "emax", "exponential",
"sigEmax", "betaMod" and "logistic" (see drmodels).'><meta property="og:description" content='Fits a dose-response model. Built-in dose-response models are "linlog", "linear", "quadratic", "emax", "exponential",
"sigEmax", "betaMod" and "logistic" (see drmodels).'><meta property="og:image" content="https://openpharma.github.io/DoseFinding/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DoseFinding</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3-1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/analysis_normal.html">Continuous data MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/binary_data.html">Binary Data MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">MCP-Mod FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/mult_regimen.html">Multiple Regimen MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/overview.html">Overview DoseFinding package</a></li>
    <li><a class="dropdown-item" href="../articles/sample_size.html">Sample size calculations for MCP-Mod</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openpharma/DoseFinding/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fit non-linear dose-response model</h1>
      <small class="dont-index">Source: <a href="https://github.com/openpharma/DoseFinding/blob/master/R/fitMod.R" class="external-link"><code>R/fitMod.R</code></a></small>
      <div class="d-none name"><code>fitMod.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Fits a dose-response model. Built-in dose-response models are "linlog", "linear", "quadratic", "emax", "exponential",
"sigEmax", "betaMod" and "logistic" (see <code><a href="drmodels.html">drmodels</a></code>).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">fitMod</span><span class="op">(</span></span>
<span>  <span class="va">dose</span>,</span>
<span>  <span class="va">resp</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  S <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"normal"</span>, <span class="st">"general"</span><span class="op">)</span>,</span>
<span>  addCovars <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>,</span>
<span>  placAdj <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">bnds</span>,</span>
<span>  df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  start <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  na.action <span class="op">=</span> <span class="va">na.fail</span>,</span>
<span>  control <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  addArgs <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'DRMod'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">object</span>, sep <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'DRMod'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'DRMod'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  predType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"full-model"</span>, <span class="st">"ls-means"</span>, <span class="st">"effect-curve"</span><span class="op">)</span>,</span>
<span>  newdata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  doseSeq <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  se.fit <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'DRMod'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  CI <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  plotData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"means"</span>, <span class="st">"meansCI"</span>, <span class="st">"raw"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>  plotGrid <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  colMn <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  colFit <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'DRMod'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'DRMod'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span>, k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'DRMod'</span></span>
<span><span class="fu">gAIC</span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span>, k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dose-resp">dose, resp<a class="anchor" aria-label="anchor" href="#arg-dose-resp"></a></dt>
<dd><p>Either vectors of equal length specifying dose and response values, or names of variables in the
data frame specified in <samp>data</samp>.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Data frame containing the variables referenced in dose and resp if <samp>data</samp> is not specified it is
assumed that <samp>dose</samp> and <samp>resp</samp> are variables referenced from data (and no vectors)</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>The dose-response model to be used for fitting the data. Built-in models are "linlog", "linear",
"quadratic", "emax", "exponential", "sigEmax", "betaMod" and "logistic" (see <a href="drmodels.html">drmodels</a>).</p></dd>


<dt id="arg-s">S<a class="anchor" aria-label="anchor" href="#arg-s"></a></dt>
<dd><p>The inverse weighting matrix used in case, when <samp>type = "general"</samp>, see Description. For later
inference statements (vcov or predict methods) it is assumed this is the estimated covariance of the estimates in
the first stage fit.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>Determines whether inference is based on an ANCOVA model under a homoscedastic normality assumption (when
<samp>type = "normal"</samp>), or estimates at the doses and their covariance matrix and degrees of freedom are specified
directly in <samp>resp</samp>, <samp>S</samp> and <samp>df</samp>. See also the Description above and Pinheiro et al. (2014).</p></dd>


<dt id="arg-addcovars">addCovars<a class="anchor" aria-label="anchor" href="#arg-addcovars"></a></dt>
<dd><p>Formula specifying additional additive linear covariates (only for <samp>type = "normal"</samp>)</p></dd>


<dt id="arg-placadj">placAdj<a class="anchor" aria-label="anchor" href="#arg-placadj"></a></dt>
<dd><p>Logical, if true, it is assumed that placebo-adjusted
estimates are specified in <samp>resp</samp> (only possible for <samp>type =
"general"</samp>).</p></dd>


<dt id="arg-bnds">bnds<a class="anchor" aria-label="anchor" href="#arg-bnds"></a></dt>
<dd><p>Bounds for non-linear parameters. If missing the the default bounds from <code><a href="defBnds.html">defBnds</a></code> is used.</p>
<p>When the dose-response model has only one non-linear parameter (for example Emax or exponential model), <samp>bnds</samp>
  needs to be a vector containing upper and lower bound. For models with two non-linear parameters <samp>bnds</samp> needs
  to be a matrix containing the bounds in the rows, see the Description section of <code><a href="defBnds.html">defBnds</a></code> for details
  on the formatting of the bounds for the individual models.</p></dd>


<dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p>Degrees of freedom to use in case of <samp>type = "general"</samp>. If this argument is missing <samp>df = Inf</samp>
is used. For <samp>type = "normal"</samp> this argument is ignored as the exact degrees of freedom can be deduced from
the model.</p></dd>


<dt id="arg-start">start<a class="anchor" aria-label="anchor" href="#arg-start"></a></dt>
<dd><p>Vector of starting values for the nonlinear parameters (ignored for linear models). When equal to NULL,
a grid optimization is performed and the best value is used as starting value for the local optimizer.</p></dd>


<dt id="arg-na-action">na.action<a class="anchor" aria-label="anchor" href="#arg-na-action"></a></dt>
<dd><p>A function which indicates what should happen when the data contain NAs.</p></dd>


<dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd><p>A list with entries: "nlminbcontrol", "optimizetol" and "gridSize".</p>
<p>The entry nlminbcontrol needs to be a list and it is passed directly to control argument in the nlminb function,
  that is used internally for models with 2 nonlinear parameters.</p>
<p>The entry optimizetol is passed directly to the tol argument of the optimize function, which is used for models
  with 1 nonlinear parameters.</p>
<p>The entry gridSize needs to be a list with entries dim1 and dim2 giving the size of the grid for the gridsearch in
  1d or 2d models.</p></dd>


<dt id="arg-addargs">addArgs<a class="anchor" aria-label="anchor" href="#arg-addargs"></a></dt>
<dd><p>List containing two entries named "scal" and "off" for the "betaMod" and "linlog" model. When addArgs
is NULL the following defaults is used <samp>list(scal = 1.2*max(doses), off = 0.01*max(doses))</samp>.</p></dd>


<dt id="arg-object-x">object, x<a class="anchor" aria-label="anchor" href="#arg-object-x"></a></dt>
<dd><p>DRMod object</p></dd>


<dt id="arg-sep">sep<a class="anchor" aria-label="anchor" href="#arg-sep"></a></dt>
<dd><p>Logical determining whether all coefficients should be returned in one numeric or separated in a list.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments for plotting for the plot method. For all other cases additional arguments are
ignored.</p></dd>


<dt id="arg-predtype-newdata-doseseq-se-fit">predType, newdata, doseSeq, se.fit<a class="anchor" aria-label="anchor" href="#arg-predtype-newdata-doseseq-se-fit"></a></dt>
<dd><p>predType determines whether predictions are returned for the full model
 (including potential covariates), the ls-means (SAS type) or the effect curve (difference to placebo).</p>
<p>newdata gives the covariates to use in producing the predictions (for predType = "full-model"), if missing the
 covariates used for fitting are used.</p>
<p>doseSeq dose-sequence on where to produce predictions (for predType = "effect-curve" and predType = "ls-means"). If
 missing the doses used for fitting are used.</p>
<p>se.fit: logical determining, whether the standard error should be calculated.</p></dd>


<dt id="arg-ci-level-plotdata-plotgrid-colmn-colfit">CI, level, plotData, plotGrid, colMn, colFit<a class="anchor" aria-label="anchor" href="#arg-ci-level-plotdata-plotgrid-colmn-colfit"></a></dt>
<dd><p>Arguments for plot method: <samp>CI</samp> determines whether confidence
intervals should be plotted. <samp>level</samp> determines the level of the confidence intervals. <samp>plotData</samp>
determines how the data are plotted: Either as means or as means with CI, raw data or none. In case of <samp>type =
"normal"</samp> and covariates the ls-means are displayed, when <samp>type = "general"</samp> the option "raw" is not available.
<samp>colMn</samp> and <samp>colFit</samp> determine the colors of fitted model and the raw means.</p></dd>


<dt id="arg-k">k<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>Penalty to use for model-selection criterion (AIC uses 2, BIC uses log(n)).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class DRMod. Essentially a list containing information about the fitted model coefficients, the
  residual sum of squares (or generalized residual sum of squares),</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>When <samp>type = "normal"</samp> ordinary least squares is used and additional additive covariates can be specified in
<samp>addCovars</samp>. The underlying assumption is hence normally distributed data and homoscedastic variance.</p>
<p>For <samp>type = "general"</samp> a generalized least squares criterion is used
$$$$$$
(f(dose,\theta)-resp)'S^{-1}(f(dose,\theta)-resp)$$
and an inverse weighting matrix is specified in <samp>S</samp>, <samp>type =
"general"</samp> is primarily of interest, when fitting a model to AN(C)OVA type
estimates obtained in a first stage fit, then <samp>resp</samp> contains the estimates and <samp>S</samp> is the estimated
covariance matrix for the estimates in <samp>resp</samp>. Statistical inference (e.g. confidence intervals) rely on
asymptotic normality of the first stage estimates, which makes this method of interest only for sufficiently large
sample size for the first stage fit. A modified model-selection criterion can be applied to these model fits (see
also Pinheiro et al. 2014 for details).</p>
<p>For details on the implemented numerical optimizer see the Details section below.</p>
<p>Details on numerical optimizer for model-fitting:<br> For linear models fitting is done using numerical linear algebra
based on the QR decomposition.  For nonlinear models numerical optimization is performed only in the nonlinear
parameters in the model and optimizing over the linear parameters in each iteration (similar as the Golub-Pereyra
implemented in <code><a href="https://rdrr.io/r/stats/nls.html" class="external-link">nls</a></code>). For models with 1 nonlinear parameter the <code><a href="https://rdrr.io/r/stats/optimize.html" class="external-link">optimize</a></code> function is used
for 2 nonlinear parameters the <code><a href="https://rdrr.io/r/stats/nlminb.html" class="external-link">nlminb</a></code> function is used. The starting value is generated using a
grid-search (with the grid size specified via <samp>control$gridSize</samp>), or can directly be handed over via
<samp>start</samp>.</p>
<p>For details on the asymptotic approximation used for <samp>type = "normal"</samp>, see Seber and Wild (2003, chapter 5).
For details on the asymptotic approximation used for <samp>type = "general"</samp>, and the gAIC, see Pinheiro et al.
(2014).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Pinheiro, J. C., Bornkamp, B., Glimm, E. and Bretz, F. (2014) Model-based dose finding under model
  uncertainty using general parametric models, <em>Statistics in Medicine</em>, <b>33</b>, 1646–1661</p>
<p>Seber, G.A.F. and Wild, C.J. (2003). Nonlinear Regression, Wiley.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="defBnds.html">defBnds</a></code>, <code><a href="drmodels.html">drmodels</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Bjoern Bornkamp</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Fit the emax model to the IBScovars data set</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">IBScovars</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fitemax</span> <span class="op">&lt;-</span> <span class="fu">fitMod</span><span class="op">(</span><span class="va">dose</span>, <span class="va">resp</span>, data<span class="op">=</span><span class="va">IBScovars</span>, model<span class="op">=</span><span class="st">"emax"</span>,</span></span>
<span class="r-in"><span>                  bnds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## methods for DRMod objects</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitemax</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dose Response Model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model: emax </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fit-type: normal </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residuals:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Min      1Q  Median      3Q     Max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -2.8748 -0.4734 -0.0296  0.4940  2.1631 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients with approx. stand. error:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Estimate Std. Error</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> e0      0.217     0.0903</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> eMax    0.377     0.1515</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ed50    0.363     0.7679</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual standard error: 0.761 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Degrees of freedom: 366 </span>
<span class="r-in"><span><span class="co">## extracting coefficients</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fitemax</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        e0      eMax      ed50 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.2171129 0.3773367 0.3628365 </span>
<span class="r-in"><span><span class="co">## (asymptotic) covariance matrix of estimates</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">fitemax</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                e0         eMax       ed50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> e0    0.008151233 -0.007833365 0.01169729</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> eMax -0.007833365  0.022948049 0.07412872</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ed50  0.011697291  0.074128715 0.58972101</span>
<span class="r-in"><span><span class="co">## predicting</span></span></span>
<span class="r-in"><span><span class="va">newdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>dose <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0.5</span>,<span class="fl">1</span><span class="op">)</span>, gender<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fitemax</span>, newdata<span class="op">=</span><span class="va">newdat</span>, predType <span class="op">=</span> <span class="st">"full-model"</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $fit</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.2171129 0.4357735 0.4939889</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $se.fit</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.09028418 0.13019577 0.08060712</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="co">## plotting</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fitemax</span>, plotData <span class="op">=</span> <span class="st">"meansCI"</span>, CI<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="fitMod-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## now include (additive) covariate gender</span></span></span>
<span class="r-in"><span><span class="va">fitemax2</span> <span class="op">&lt;-</span> <span class="fu">fitMod</span><span class="op">(</span><span class="va">dose</span>, <span class="va">resp</span>, data<span class="op">=</span><span class="va">IBScovars</span>, model<span class="op">=</span><span class="st">"emax"</span>,</span></span>
<span class="r-in"><span>                   addCovars <span class="op">=</span> <span class="op">~</span><span class="va">gender</span>, bnds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">fitemax2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   e0          eMax          ed50       gender2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> e0       0.011767275 -0.0080170385  0.0118789742 -0.0050993260</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> eMax    -0.008017039  0.0230221644  0.0744025962  0.0002308542</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ed50     0.011878974  0.0744025962  0.5924163063 -0.0001905096</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> gender2 -0.005099326  0.0002308542 -0.0001905096  0.0072354137</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fitemax2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="fitMod-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">## fitted log-likelihood</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/logLik.html" class="external-link">logLik</a></span><span class="op">(</span><span class="va">fitemax2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 'log Lik.' -421.1925 (df=5)</span>
<span class="r-in"><span><span class="co">## extracting AIC (or BIC)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/AIC.html" class="external-link">AIC</a></span><span class="op">(</span><span class="va">fitemax2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 852.3851</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Illustrating the "general" approach for a binary regression</span></span></span>
<span class="r-in"><span><span class="co">## produce first stage fit (using dose as factor)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">migraine</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">PFrate</span> <span class="op">&lt;-</span> <span class="va">migraine</span><span class="op">$</span><span class="va">painfree</span><span class="op">/</span><span class="va">migraine</span><span class="op">$</span><span class="va">ntrt</span></span></span>
<span class="r-in"><span><span class="va">doseVec</span> <span class="op">&lt;-</span> <span class="va">migraine</span><span class="op">$</span><span class="va">dose</span></span></span>
<span class="r-in"><span><span class="va">doseVecFac</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">migraine</span><span class="op">$</span><span class="va">dose</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## fit logistic regression with dose as factor</span></span></span>
<span class="r-in"><span><span class="va">fitBin</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">PFrate</span><span class="op">~</span><span class="va">doseVecFac</span><span class="op">-</span><span class="fl">1</span>, family <span class="op">=</span> <span class="va">binomial</span>,</span></span>
<span class="r-in"><span>              weights <span class="op">=</span> <span class="va">migraine</span><span class="op">$</span><span class="va">ntrt</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">drEst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fitBin</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">vCov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">fitBin</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## now fit an Emax model (on logit scale)</span></span></span>
<span class="r-in"><span><span class="va">gfit</span> <span class="op">&lt;-</span> <span class="fu">fitMod</span><span class="op">(</span><span class="va">doseVec</span>, <span class="va">drEst</span>, S<span class="op">=</span><span class="va">vCov</span>, model <span class="op">=</span> <span class="st">"emax"</span>, bnds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                type <span class="op">=</span> <span class="st">"general"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## model fit on logit scale</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gfit</span>, plotData <span class="op">=</span> <span class="st">"meansCI"</span>, CI <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="fitMod-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">## model on probability scale</span></span></span>
<span class="r-in"><span><span class="va">logitPred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">gfit</span>, predType <span class="op">=</span><span class="st">"ls-means"</span>, doseSeq <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">200</span>,</span></span>
<span class="r-in"><span>                     se.fit<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">200</span>, <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">logitPred</span><span class="op">$</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     ylab <span class="op">=</span> <span class="st">"Probability of being painfree"</span>, xlab <span class="op">=</span> <span class="st">"Dose"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">LB</span> <span class="op">&lt;-</span> <span class="va">logitPred</span><span class="op">$</span><span class="va">fit</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">)</span><span class="op">*</span><span class="va">logitPred</span><span class="op">$</span><span class="va">se.fit</span></span></span>
<span class="r-in"><span><span class="va">UB</span> <span class="op">&lt;-</span> <span class="va">logitPred</span><span class="op">$</span><span class="va">fit</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">0.975</span><span class="op">)</span><span class="op">*</span><span class="va">logitPred</span><span class="op">$</span><span class="va">se.fit</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">200</span>, <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">LB</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fl">0</span><span class="op">:</span><span class="fl">200</span>, <span class="fl">1</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">UB</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="fitMod-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## now illustrate "general" approach for placebo-adjusted data (on</span></span></span>
<span class="r-in"><span><span class="co">## IBScovars) note that the estimates are identical to fitemax2 above)</span></span></span>
<span class="r-in"><span><span class="va">anovaMod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">resp</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span><span class="op">+</span><span class="va">gender</span>, data<span class="op">=</span><span class="va">IBScovars</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">drFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">anovaMod</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="co"># placebo adjusted estimates at doses</span></span></span>
<span class="r-in"><span><span class="va">vCov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">anovaMod</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">IBScovars</span><span class="op">$</span><span class="va">dose</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co">## now fit an emax model to these estimates</span></span></span>
<span class="r-in"><span><span class="va">gfit2</span> <span class="op">&lt;-</span> <span class="fu">fitMod</span><span class="op">(</span><span class="va">dose</span>, <span class="va">drFit</span>, S<span class="op">=</span><span class="va">vCov</span>, model <span class="op">=</span> <span class="st">"emax"</span>, type <span class="op">=</span> <span class="st">"general"</span>,</span></span>
<span class="r-in"><span>               placAdj <span class="op">=</span> <span class="cn">TRUE</span>, bnds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## some outputs</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">gfit2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dose Response Model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model: emax </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fit-type: general </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients with approx. stand. error:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Estimate Std. Error</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> eMax    0.377      0.152</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ed50    0.363      0.772</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fitted to:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1     2     3     4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.285 0.297 0.350 0.348 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> with Covariance Matrix:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         1       2       3       4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 0.01570 0.00822 0.00822 0.00822</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 0.00822 0.01600 0.00825 0.00821</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 0.00822 0.00825 0.01640 0.00820</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 0.00822 0.00821 0.00820 0.01620</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">gfit2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      eMax      ed50 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.3771103 0.3630332 </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">gfit2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            eMax      ed50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> eMax 0.02314275 0.0747923</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ed50 0.07479230 0.5955193</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">gfit2</span>, se.fit <span class="op">=</span> <span class="cn">TRUE</span>, doseSeq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span><span class="op">)</span>, predType <span class="op">=</span> <span class="st">"effect-curve"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $fit</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.2766699 0.3191748 0.3364020 0.3457323</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $se.fit</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.1213133 0.1016972 0.1050097 0.1110139</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gfit2</span>, CI<span class="op">=</span><span class="cn">TRUE</span>, plotData <span class="op">=</span> <span class="st">"meansCI"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="fitMod-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu">gAIC</span><span class="op">(</span><span class="va">gfit2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 4.098152</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bjoern Bornkamp, Jose Pinheiro, Frank Bretz, Ludger Sandig, Marius Thomas, Novartis Pharma AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

