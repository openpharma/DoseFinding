<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Performs Bayesian multiple contrast test — bMCTtest • DoseFinding</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Performs Bayesian multiple contrast test — bMCTtest"><meta name="description" content="This function performs a Bayesian multiple contrast test using normal mixture priors for the response on each dose,
as proposed in Fleischer et al. (2022). For a general description of the multiple contrast test see
MCTtest."><meta property="og:description" content="This function performs a Bayesian multiple contrast test using normal mixture priors for the response on each dose,
as proposed in Fleischer et al. (2022). For a general description of the multiple contrast test see
MCTtest."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DoseFinding</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3-1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/analysis_normal.html">Continuous data MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/binary_data.html">Binary Data MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">MCP-Mod FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/mult_regimen.html">Multiple Regimen MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/overview.html">Overview DoseFinding package</a></li>
    <li><a class="dropdown-item" href="../articles/sample_size.html">Sample size calculations for MCP-Mod</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openpharma/DoseFinding/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Performs Bayesian multiple contrast test</h1>
      <small class="dont-index">Source: <a href="https://github.com/openpharma/DoseFinding/blob/master/R/bMCTtest.R" class="external-link"><code>R/bMCTtest.R</code></a></small>
      <div class="d-none name"><code>bMCTtest.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function performs a Bayesian multiple contrast test using normal mixture priors for the response on each dose,
as proposed in Fleischer et al. (2022). For a general description of the multiple contrast test see
<code><a href="MCTtest.html">MCTtest</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">bMCTtest</span><span class="op">(</span></span>
<span>  <span class="va">dose</span>,</span>
<span>  <span class="va">resp</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">models</span>,</span>
<span>  S <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"normal"</span>, <span class="st">"general"</span><span class="op">)</span>,</span>
<span>  <span class="va">prior</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.025</span>,</span>
<span>  na.action <span class="op">=</span> <span class="va">na.fail</span>,</span>
<span>  mvtcontrol <span class="op">=</span> <span class="fu"><a href="mvtnorm-control.html">mvtnorm.control</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  contMat <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  critV <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-dose-resp">dose, resp<a class="anchor" aria-label="anchor" href="#arg-dose-resp"></a></dt>
<dd><p>Either vectors of equal length specifying dose and response values, or names of variables in the
data frame specified in <samp>data</samp>.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>Data frame containing the variables referenced in dose and resp if <samp>data</samp> is not specified it is
assumed that <samp>dose</samp> and <samp>resp</samp> are variables referenced from data (and no vectors)</p></dd>


<dt id="arg-models">models<a class="anchor" aria-label="anchor" href="#arg-models"></a></dt>
<dd><p>An object of class <samp>Mods</samp>, see <code><a href="Mods.html">Mods</a></code> for details</p></dd>


<dt id="arg-s">S<a class="anchor" aria-label="anchor" href="#arg-s"></a></dt>
<dd><p>The covariance matrix of <samp>resp</samp> when <samp>type = "general"</samp>, see Description.</p></dd>


<dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>Determines whether inference is based on an ANCOVA model under a homoscedastic normality assumption (when
<samp>type = "normal"</samp>), or estimates at the doses and their covariance matrix and degrees of freedom are specified
directly in <samp>resp</samp>, <samp>S</samp> and <samp>df</samp>. See also <code><a href="fitMod.html">fitMod</a></code> and Pinheiro et al. (2014).</p></dd>


<dt id="arg-prior">prior<a class="anchor" aria-label="anchor" href="#arg-prior"></a></dt>
<dd><p>List of length equal to the number of doses with the prior for each arm.  Each element needs to be of
class <samp>normMix</samp> (See <samp>RBesT</samp> package documentation). It is assumed that the i-th component of the prior
list corresponds to the i-th largest dose. For example the first entry in the list is the prior for the placebo
group, the second entry the prior for the second lowest dose and so on.  Internally the priors across the different
arms are combined (densities multiplied) assuming independence. The resulting multivariate normal mixture prior
will have as many components as the product of the number of components of the individual mixture priors. The
posterior mixture is part of the result object under "posterior".</p></dd>


<dt id="arg-alpha">alpha<a class="anchor" aria-label="anchor" href="#arg-alpha"></a></dt>
<dd><p>Significance level for the frequentist multiple contrast test. If no critical values are supplied via
<samp>critV</samp> this is used to derive critical values for Bayesian decision rule.</p></dd>


<dt id="arg-na-action">na.action<a class="anchor" aria-label="anchor" href="#arg-na-action"></a></dt>
<dd><p>A function which indicates what should happen when the data contain NAs.</p></dd>


<dt id="arg-mvtcontrol">mvtcontrol<a class="anchor" aria-label="anchor" href="#arg-mvtcontrol"></a></dt>
<dd><p>A list specifying additional control parameters for the <samp>qmvt</samp> and <samp>pmvt</samp> calls in the
code, see also <code><a href="mvtnorm-control.html">mvtnorm.control</a></code> for details.</p></dd>


<dt id="arg-contmat">contMat<a class="anchor" aria-label="anchor" href="#arg-contmat"></a></dt>
<dd><p>Contrast matrix to apply to the posterior dose-response estimates. The contrasts need to be in the
columns of the matrix (i.e. the column sums need to be 0). If not specified optimal contrasts are calculated using
<code><a href="optContr.html">optContr</a></code>.</p></dd>


<dt id="arg-critv">critV<a class="anchor" aria-label="anchor" href="#arg-critv"></a></dt>
<dd><p>Supply a critical value for the maximum posterior probability of the contrasts being greater than zero
that needs to be surpassed to establish a non-flat dose-response. If this argument is NULL, this will be derived
from critical values for frequentist MCP-Mod using the provided <samp>alpha</samp>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class bMCTtest, a list containing the output.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>If <samp>type = "normal"</samp>, an ANCOVA model based on a homoscedastic normality assumption is fitted and posteriors for
dose-response and contrast vectors are obtained assuming a known variance.</p>
<p>For <samp>type = "general"</samp> it is assumed multivariate normally distributed estimates are specified in <samp>resp</samp>
with covariance given by <samp>S</samp>, which define the likelihood.  Posteriors for dose-response and contrast vectors
are then obtained assuming a known covariance matrix S</p>
<p>The multiple contrast test decision is based on the maximum posterior probability of a contrast being greater than
zero. Thresholds for the posterior probability can either be supplied or will be derived from frequentist critical
values. In the latter case the Bayesian test will give approximately the same results as the frequentist multiple
contrast test if uninformative priors are used.</p>
<p>For the default calculation of optimal contrasts the prior information is ignored (i.e. contrasts are calculated in
the same way as in <code><a href="MCTtest.html">MCTtest</a></code>).  Fleischer et al. (2022) discuss using contrasts that take the prior
effective sample sizes into account, which can be slightly more favourable for the Bayesian MCT test. Such
alternative contrasts can be directly handed over via the <samp>contMat</samp> argument.</p>
<p>For analysis with covariate adjustment, covariate-adjusted <samp>resp</samp> and <samp>S</samp> can be supplied together with
using <samp>type = "general"</samp>. See  `vignette("binary_data")` vignette "Design and analysis template MCP-Mod for binary data" for an example
on how to obtain covariate adjusted estimates.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Fleischer, F., Bossert, S., Deng, Q., Loley, C. and Gierse, J. (2022).  Bayesian MCP-Mod,
  <em>Pharmaceutical Statistics</em>, <b>21</b>, 654–670</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="MCTtest.html">MCTtest</a></code>, <code><a href="optContr.html">optContr</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Marius Thomas</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://opensource.nibr.com/RBesT/" class="external-link">"RBesT"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">###############################</span></span></span>
<span class="r-in"><span><span class="co">## Normal outcome</span></span></span>
<span class="r-in"><span><span class="co">###############################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">biom</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## define shapes for which to calculate optimal contrasts</span></span></span>
<span class="r-in"><span><span class="va">doses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span>, <span class="fl">0.2</span>, <span class="fl">0.6</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">modlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="Mods.html">Mods</a></span><span class="op">(</span>emax <span class="op">=</span> <span class="fl">0.05</span>, linear <span class="op">=</span> <span class="cn">NULL</span>, logistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                linInt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, doses <span class="op">=</span> <span class="va">doses</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## specify an informative prior for placebo, weakly informative for other arms</span></span></span>
<span class="r-in"><span><span class="va">plc_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/mixnorm.html" class="external-link">mixnorm</a></span><span class="op">(</span>inf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.4</span>, <span class="fl">0.1</span><span class="op">)</span>, rob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">vague_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/mixnorm.html" class="external-link">mixnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## i-th component of the prior list corresponds to the i-th largest dose</span></span></span>
<span class="r-in"><span><span class="co">## (e.g. 1st component -&gt; placebo prior; last component prior for top dose)</span></span></span>
<span class="r-in"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">plc_prior</span>, <span class="va">vague_prior</span>, <span class="va">vague_prior</span>, <span class="va">vague_prior</span>, <span class="va">vague_prior</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu">bMCTtest</span><span class="op">(</span><span class="va">dose</span>, <span class="va">resp</span>, <span class="va">biom</span>, models<span class="op">=</span><span class="va">modlist</span>, prior <span class="op">=</span> <span class="va">prior</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## now supply a critical value (= threshold for maxmimum posterior probability)</span></span></span>
<span class="r-in"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu">bMCTtest</span><span class="op">(</span><span class="va">dose</span>, <span class="va">resp</span>, <span class="va">biom</span>, models<span class="op">=</span><span class="va">modlist</span>, prior <span class="op">=</span> <span class="va">prior</span>, critV <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">####################################</span></span></span>
<span class="r-in"><span><span class="co">## Binary outcome with covariates</span></span></span>
<span class="r-in"><span><span class="co">####################################</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co">## generate data</span></span></span>
<span class="r-in"><span><span class="va">logit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">p</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">p</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">p</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">inv_logit</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="fl">1</span> <span class="op">/</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">doses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1.5</span>, <span class="fl">2.5</span>, <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## set seed and ensure reproducibility across R versions</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span>, kind <span class="op">=</span> <span class="st">"Mersenne-Twister"</span>, sample.kind <span class="op">=</span> <span class="st">"Rejection"</span>, normal.kind <span class="op">=</span> <span class="st">"Inversion"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">group_size</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="va">dose_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">doses</span>, each <span class="op">=</span> <span class="va">group_size</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dose_vector</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## generate covariates</span></span></span>
<span class="r-in"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span><span class="op">)</span>, <span class="va">N</span>, replace <span class="op">=</span> <span class="cn">TRUE</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.6</span>, <span class="fl">0.4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## assume approximately logit(10%) placebo and logit(35%) asymptotic response with ED50=0.5</span></span></span>
<span class="r-in"><span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/lodds.html" class="external-link">inv_logit</a></span><span class="op">(</span><span class="fu"><a href="drmodels.html">emax</a></span><span class="op">(</span><span class="va">dose_vector</span>, <span class="op">-</span><span class="fl">2.2</span>, <span class="fl">1.6</span>, <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="va">x1</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="op">(</span><span class="va">x2</span> <span class="op">==</span> <span class="st">"B"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="va">prob</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                  dose <span class="op">=</span> <span class="va">dose_vector</span>, x1 <span class="op">=</span> <span class="va">x1</span>, x2 <span class="op">=</span> <span class="va">x2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## specify an informative prior for placebo (on logit scale), weakly informative for other arms</span></span></span>
<span class="r-in"><span><span class="va">plc_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/mixnorm.html" class="external-link">mixnorm</a></span><span class="op">(</span>inf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">0.5</span><span class="op">)</span>, rob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">vague_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/mixnorm.html" class="external-link">mixnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">plc_prior</span>, <span class="va">vague_prior</span>, <span class="va">vague_prior</span>, <span class="va">vague_prior</span>, <span class="va">vague_prior</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## candidate models</span></span></span>
<span class="r-in"><span><span class="va">mods</span> <span class="op">&lt;-</span> <span class="fu"><a href="Mods.html">Mods</a></span><span class="op">(</span>emax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">1</span><span class="op">)</span>, sigEmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>, betaMod <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.1</span>, <span class="fl">1.1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             placEff <span class="op">=</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/lodds.html" class="external-link">logit</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>, maxEff <span class="op">=</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/lodds.html" class="external-link">logit</a></span><span class="op">(</span><span class="fl">0.35</span><span class="op">)</span><span class="op">-</span><span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/lodds.html" class="external-link">logit</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             doses <span class="op">=</span> <span class="va">doses</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">fit_cov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">y</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">covariate_adjusted_estimates</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mu_hat</span>, <span class="va">S_hat</span>, <span class="va">formula_rhs</span>,</span></span>
<span class="r-in"><span>                                         <span class="va">doses</span>, <span class="va">other_covariates</span>, <span class="va">n_sim</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="co">## predict every patient under *every* dose</span></span></span>
<span class="r-in"><span>  <span class="va">oc_rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">other_covariates</span>, <span class="kw">function</span><span class="op">(</span><span class="va">col</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">col</span>, times <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">doses</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">d_rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">doses</span>, each <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">other_covariates</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">pdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">oc_rep</span>, dose <span class="op">=</span> <span class="va">d_rep</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="va">formula_rhs</span>, <span class="va">pdat</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co">## average on probability scale then backtransform to logit scale</span></span></span>
<span class="r-in"><span>  <span class="va">mu_star</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/lodds.html" class="external-link">logit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/lodds.html" class="external-link">inv_logit</a></span><span class="op">(</span><span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">mu_hat</span><span class="op">)</span>, <span class="va">pdat</span><span class="op">$</span><span class="va">dose</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co">## estimate covariance matrix of mu_star</span></span></span>
<span class="r-in"><span>  <span class="va">pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">n_sim</span>, <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/lodds.html" class="external-link">logit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/lodds.html" class="external-link">inv_logit</a></span><span class="op">(</span><span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="fu">mvtnorm</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">rmvnorm</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">mu_hat</span>, <span class="va">S_hat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                                        <span class="va">pdat</span><span class="op">$</span><span class="va">dose</span>, <span class="va">mean</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mu_star <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">mu_star</span><span class="op">)</span>, S_star <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">pred</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ca</span> <span class="op">&lt;-</span> <span class="fu">covariate_adjusted_estimates</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_cov</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">fit_cov</span><span class="op">)</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span><span class="op">+</span><span class="fl">0</span><span class="op">+</span><span class="va">x1</span><span class="op">+</span><span class="va">x2</span>,</span></span>
<span class="r-in"><span>                                   <span class="va">doses</span>, <span class="va">dat</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x1"</span>, <span class="st">"x2"</span><span class="op">)</span><span class="op">]</span>, <span class="fl">1000</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">bMCTtest</span><span class="op">(</span><span class="va">doses</span>, <span class="va">ca</span><span class="op">$</span><span class="va">mu_star</span>, S <span class="op">=</span> <span class="va">ca</span><span class="op">$</span><span class="va">S_star</span>, type <span class="op">=</span> <span class="st">"general"</span>, models <span class="op">=</span> <span class="va">mods</span>, prior <span class="op">=</span> <span class="va">prior</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span><span class="co">################################################</span></span></span>
<span class="r-in"><span><span class="co">## example with contrasts handed over</span></span></span>
<span class="r-in"><span><span class="co">################################################</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">biom</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## define shapes for which to calculate optimal contrasts</span></span></span>
<span class="r-in"><span><span class="va">doses</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span>, <span class="fl">0.2</span>, <span class="fl">0.6</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">modlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="Mods.html">Mods</a></span><span class="op">(</span>emax <span class="op">=</span> <span class="fl">0.05</span>, linear <span class="op">=</span> <span class="cn">NULL</span>, sigEmax <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">5</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                linInt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, doses <span class="op">=</span> <span class="va">doses</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## specify an informative prior for placebo, weakly informative for other arms</span></span></span>
<span class="r-in"><span><span class="va">plc_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/mixnorm.html" class="external-link">mixnorm</a></span><span class="op">(</span>inf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.8</span>, <span class="fl">0.4</span>, <span class="fl">0.1</span><span class="op">)</span>, rob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">10</span><span class="op">)</span>, sigma <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">vague_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://opensource.nibr.com/RBesT/reference/mixnorm.html" class="external-link">mixnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, sigma <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">plc_prior</span>, <span class="va">vague_prior</span>, <span class="va">vague_prior</span>, <span class="va">vague_prior</span>, <span class="va">vague_prior</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## use prior effective sample sizes to calculate optimal contrasts</span></span></span>
<span class="r-in"><span><span class="va">prior_ess</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">prior</span>, <span class="va">ess</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n_grp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">biom</span><span class="op">$</span><span class="va">dose</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">weights</span> <span class="op">&lt;-</span> <span class="va">n_grp</span> <span class="op">+</span> <span class="va">prior_ess</span></span></span>
<span class="r-in"><span><span class="va">cmat</span> <span class="op">&lt;-</span> <span class="fu"><a href="optContr.html">optContr</a></span><span class="op">(</span><span class="va">modlist</span>, w <span class="op">=</span> <span class="va">weights</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">bMCTtest</span><span class="op">(</span><span class="va">dose</span>, <span class="va">resp</span>, <span class="va">biom</span>, models<span class="op">=</span><span class="va">modlist</span>, prior <span class="op">=</span> <span class="va">prior</span>, contMat <span class="op">=</span> <span class="va">cmat</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: RBesT</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> This is RBesT version 1.8.2 (released 2025-04-25, git-sha b9dab00)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using default prior reference scale 0.7</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using default prior reference scale 0.7</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using default prior reference scale 0.7</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using default prior reference scale 0.7</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using default prior reference scale 0.7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bayesian MCP-Mod</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Contrasts:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        emax linear sigEmax linInt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0    -0.870 -0.681  -0.609 -0.762</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.05  0.026 -0.191  -0.210 -0.263</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.2   0.221 -0.060  -0.201  0.342</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.6   0.302  0.291   0.400  0.342</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     0.321  0.641   0.620  0.342</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Posterior Mixture Weights:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Comp. 1 Comp. 2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.995   0.005 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bayesian t-statistics:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         Comp. 1 Comp. 2 posterior probability</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> linInt    4.167   3.372                     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> emax      4.111   2.996                     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> linear    3.709   3.198                     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sigEmax   3.437   3.095                     1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Critical value (for maximum posterior probability): 0.987 (alpha = 0.025, one-sided) </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bjoern Bornkamp, Jose Pinheiro, Frank Bretz, Ludger Sandig, Marius Thomas, Novartis Pharma AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

