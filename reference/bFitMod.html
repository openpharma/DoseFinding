<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Fit a dose-response model using Bayesian or bootstrap methods. — bFitMod • DoseFinding</title><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Fit a dose-response model using Bayesian or bootstrap methods. — bFitMod"><meta name="description" content='For type = "Bayes", MCMC sampling from the posterior distribution of
  the dose-response model is done. The function assumes a multivariate
  normal distribution for resp with covariance matrix S,
  and this is taken as likelihood function and combined with the prior
  distributions specified in prior to form the posterior distribution.
For type = "bootstrap", a multivariate normal distribution for
  resp with covariance matrix S is assumed, and a large
  number of samples is drawn from this distribution. For each draw the
  fitMod function with type = "general" is used to fit the draws
  from the multivariate normal distribution.'><meta property="og:description" content='For type = "Bayes", MCMC sampling from the posterior distribution of
  the dose-response model is done. The function assumes a multivariate
  normal distribution for resp with covariance matrix S,
  and this is taken as likelihood function and combined with the prior
  distributions specified in prior to form the posterior distribution.
For type = "bootstrap", a multivariate normal distribution for
  resp with covariance matrix S is assumed, and a large
  number of samples is drawn from this distribution. For each draw the
  fitMod function with type = "general" is used to fit the draws
  from the multivariate normal distribution.'><meta property="og:image" content="https://openpharma.github.io/DoseFinding/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">DoseFinding</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3-1.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/analysis_normal.html">Continuous data MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/binary_data.html">Binary Data MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/faq.html">MCP-Mod FAQ</a></li>
    <li><a class="dropdown-item" href="../articles/mult_regimen.html">Multiple Regimen MCP-Mod</a></li>
    <li><a class="dropdown-item" href="../articles/overview.html">Overview DoseFinding package</a></li>
    <li><a class="dropdown-item" href="../articles/sample_size.html">Sample size calculations for MCP-Mod</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/openpharma/DoseFinding/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Fit a dose-response model using Bayesian or bootstrap methods.</h1>

      <div class="d-none name"><code>bFitMod.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>For <samp>type = "Bayes"</samp>, MCMC sampling from the posterior distribution of
  the dose-response model is done. The function assumes a multivariate
  normal distribution for <code>resp</code> with covariance matrix <code>S</code>,
  and this is taken as likelihood function and combined with the prior
  distributions specified in prior to form the posterior distribution.</p>
<p>For <samp>type = "bootstrap"</samp>, a multivariate normal distribution for
  <code>resp</code> with covariance matrix <code>S</code> is assumed, and a large
  number of samples is drawn from this distribution. For each draw the
  fitMod function with <samp>type = "general"</samp> is used to fit the draws
  from the multivariate normal distribution.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">bFitMod</span><span class="op">(</span><span class="va">dose</span>, <span class="va">resp</span>, <span class="va">model</span>, <span class="va">S</span>, placAdj <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>        type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Bayes"</span>, <span class="st">"bootstrap"</span><span class="op">)</span>,</span>
<span>        start <span class="op">=</span> <span class="cn">NULL</span>, prior <span class="op">=</span> <span class="cn">NULL</span>, nSim <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>        MCMCcontrol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, control <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">bnds</span>, </span>
<span>        addArgs <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'bFitMod'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'bFitMod'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">object</span>, predType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"full-model"</span>, <span class="st">"effect-curve"</span><span class="op">)</span>,</span>
<span>        summaryFct <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">x</span>, probs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.975</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        doseSeq <span class="op">=</span> <span class="cn">NULL</span>, lenSeq <span class="op">=</span> <span class="fl">101</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'bFitMod'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, plotType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"dr-curve"</span>, <span class="st">"effect-curve"</span><span class="op">)</span>,</span>
<span>        quant <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span><span class="op">)</span>, </span>
<span>        plotData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"means"</span>, <span class="st">"meansCI"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>        level <span class="op">=</span> <span class="fl">0.95</span>, lenDose <span class="op">=</span> <span class="fl">201</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-dose">dose<a class="anchor" aria-label="anchor" href="#arg-dose"></a></dt>
<dd><p>Numeric specifying the dose variable.</p></dd>

  <dt id="arg-resp">resp<a class="anchor" aria-label="anchor" href="#arg-resp"></a></dt>
<dd><p>Numeric specifying the response estimate
    corresponding to the doses in <code>dose</code></p></dd>

  <dt id="arg-s">S<a class="anchor" aria-label="anchor" href="#arg-s"></a></dt>
<dd><p>Covariance matrix associated with the dose-response
    estimate specified via <code>resp</code></p></dd>

  <dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p>Dose-response model to fit, possible models are
    "linlog", "linear", "quadratic", "emax", "exponential",
    "sigEmax", "betaMod" and "logistic", see <code><a href="drmodels.html">drmodels</a></code>.</p></dd>

  <dt id="arg-placadj">placAdj<a class="anchor" aria-label="anchor" href="#arg-placadj"></a></dt>
<dd><p>Whether or not estimates in "placAdj" are
    placebo-adjusted (note that the linear in log and
    the logistic model cannot be fitted for placebo-adjusted data)</p></dd>

  <dt id="arg-type">type<a class="anchor" aria-label="anchor" href="#arg-type"></a></dt>
<dd><p>Character with allowed values "Bayes" and "bootstrap", Determining
    whether samples are drawn from the posterior, or the bootstrap
    distribution.</p></dd>

  <dt id="arg-start">start<a class="anchor" aria-label="anchor" href="#arg-start"></a></dt>
<dd><p>Optional starting values for the dose-response
    parameters in the MCMC algorithm.</p></dd>

  <dt id="arg-prior">prior<a class="anchor" aria-label="anchor" href="#arg-prior"></a></dt>
<dd><p>List containing the information regarding the prior distributions
    for <samp>type = "Bayes"</samp>.
    The list needs to have as many entries as there are model
    parameters. The ordering of the list entries should be the same as
     in the arguments list of the model see (see <code><a href="drmodels.html">drmodels</a></code>).
    For example for the Emax model the first entry determines the prior
    for e0, the second to eMax and the third to ed50.</p>
<p>For each list entry the user has the choice to choose
    from 4 possible distributions:</p><ul><li><p><code>norm</code>: Vector of length 2 giving mean and standard deviation.</p></li>
<li><p><code>t</code>: Vector of length 3  giving median, scale and degrees
      of freedom of the t-distribution.</p></li>
<li><p><code>lnorm</code>: Vector of length 2 giving mean and standard
      deviation on log scale.</p></li>
<li><p><code>beta</code>: Vector of length 4 giving lower and upper bound
      of the beta prior as well as the alpha and beta parameters of the
      beta distribution</p></li>
</ul><p></p></dd>

  <dt id="arg-nsim">nSim<a class="anchor" aria-label="anchor" href="#arg-nsim"></a></dt>
<dd><p>Desired number of samples to produce with the algorithm</p></dd>

  <dt id="arg-mcmccontrol">MCMCcontrol<a class="anchor" aria-label="anchor" href="#arg-mcmccontrol"></a></dt>
<dd><p>List of control parameters for the MCMC algorithm</p><ul><li><p><code>thin</code> Thinning rate. Must be a positive integer.</p></li>
<li><p><code>w</code> Numeric of same length as number of parameters in
      the model, specifies the width parameters of the slice sampler.</p></li>
<li><p><code>adapt</code> Logical whether to adapt the <code>w</code> (width)
      parameter of the slice sampler in a short trial run. The widths
      are chosen as IQR/1.3 of the trial run.</p></li>
</ul><p></p></dd>

  <dt id="arg-control">control<a class="anchor" aria-label="anchor" href="#arg-control"></a></dt>
<dd><p>Same as the control argument in <code><a href="fitMod.html">fitMod</a></code>.</p></dd>

  <dt id="arg-bnds">bnds<a class="anchor" aria-label="anchor" href="#arg-bnds"></a></dt>
<dd><p>Bounds for non-linear parameters, in case <samp>type =
    "bootstrap"</samp>. If missing the the default bounds from
    <code><a href="defBnds.html">defBnds</a></code> is used.</p></dd>

  <dt id="arg-addargs">addArgs<a class="anchor" aria-label="anchor" href="#arg-addargs"></a></dt>
<dd><p>List containing two entries named "scal" and "off" for the "betaMod"
    and "linlog" model. When addArgs is NULL the following defaults are
    used <samp>list(scal = 1.2*max(doses), off = 0.01*max(doses))</samp></p></dd>

  <dt id="arg-x-object">x, object<a class="anchor" aria-label="anchor" href="#arg-x-object"></a></dt>
<dd><p>A bFitMod object</p></dd>

  <dt id="arg-predtype-summaryfct-doseseq-lenseq">predType, summaryFct, doseSeq, lenSeq<a class="anchor" aria-label="anchor" href="#arg-predtype-summaryfct-doseseq-lenseq"></a></dt>
<dd><p>Arguments for the predict method.</p>
<p><samp>predType</samp>: predType determines whether predictions are returned
    for the dose-response curve or the effect curve (difference to placebo).</p>
<p><samp>summaryFct</samp>: If equal to NULL predictions are calculated for
    each sampled parameter value. Otherwise a summary function is
    applied to the dose-response predictions for each parameter value.
    The default is to calculate 0.025, 0.25, 0.5, 0.75, 0.975 quantiles
    of the predictions for each dose.</p>
<p><samp>doseSeq</samp>: Where to calculate predictions. If not specified
    predictions are calculated on a grid of length <samp>lenSeq</samp> between
    minimum and maximum dose.</p>
<p><samp>lenSeq</samp>: Length of the default grid where to calculate
    predictions.</p></dd>

  <dt id="arg-plottype-quant-plotdata-level-lendose">plotType, quant, plotData, level, lenDose<a class="anchor" aria-label="anchor" href="#arg-plottype-quant-plotdata-level-lendose"></a></dt>
<dd><p>Arguments for plot method.</p>
<p><samp>plotType</samp>: Determining whether the dose-response curve or the
    effect curve should be plotted.</p>
<p><samp>quant</samp>: Vector of quantiles to display in plot</p>
<p><samp>plotData</samp>: Determines how the original data are plotted:
    Either as means or as means with CI or not. The level of the CI is
    determined by the argument <samp>level</samp>.</p>
<p><samp>level</samp>: Level for CI, when plotData is equal to
    <samp>meansCI</samp>.</p>
<p><samp>lenDose</samp>: Number of grid values to use for display.</p></dd>

  <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments are ignored.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Componentwise univariate slice samplers are implemented (see Neal,
  2003) to sample from the posterior distribution.</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object of class bFitMod, which is a list containing the matrix of
  posterior simulations plus some additional information on the fitted
  model.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Neal, R. M. (2003), Slice sampling, Annals of Statistics, 31, 705-767</p>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Bjoern Bornkamp</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="fitMod.html">fitMod</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">biom</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co">## produce first stage fit (using dose as factor)</span></span></span>
<span class="r-in"><span>  <span class="va">anMod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">resp</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span><span class="op">-</span><span class="fl">1</span>, data<span class="op">=</span><span class="va">biom</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">drFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">anMod</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">S</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">anMod</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">biom</span><span class="op">$</span><span class="va">dose</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co">## define prior list</span></span></span>
<span class="r-in"><span>  <span class="co">## normal prior for E0 (mean=0 and sdev=10)</span></span></span>
<span class="r-in"><span>  <span class="co">## normal prior for Emax (mean=0 and sdev=100)</span></span></span>
<span class="r-in"><span>  <span class="co">## beta prior for ED50: bounds: [0,1.5] parameters shape1=0.45, shape2=1.7</span></span></span>
<span class="r-in"><span>  <span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>norm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, norm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span>, beta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1.5</span>,<span class="fl">0.45</span>,<span class="fl">1.7</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co">## now fit an emax model</span></span></span>
<span class="r-in"><span>  <span class="va">gsample</span> <span class="op">&lt;-</span> <span class="fu">bFitMod</span><span class="op">(</span><span class="va">dose</span>, <span class="va">drFit</span>, <span class="va">S</span>, model <span class="op">=</span> <span class="st">"emax"</span>, </span></span>
<span class="r-in"><span>                      start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>, nSim <span class="op">=</span> <span class="fl">1000</span>, prior <span class="op">=</span> <span class="va">prior</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co">## summary information</span></span></span>
<span class="r-in"><span>  <span class="va">gsample</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dose Response Model</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model: emax </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary of posterior draws</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       mean  sdev   2.5%   25%   50%   75% 97.5% n.eff</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> e0   0.347 0.139 0.0476 0.266 0.355 0.446 0.588   184</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> eMax 0.893 0.342 0.3428 0.652 0.856 1.074 1.742   156</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ed50 0.378 0.335 0.0218 0.115 0.266 0.557 1.216   133</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Fitted to:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       0    0.05     0.2     0.6       1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.34491 0.45675 0.81032 0.93444 0.94871 </span>
<span class="r-in"><span>  <span class="co">## samples are stored in</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">gsample</span><span class="op">$</span><span class="va">samples</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               e0      eMax        ed50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  0.15284581 0.9570781 0.042075268</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  0.03231835 0.8573154 0.044708444</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]  0.05388497 0.9142132 0.024812400</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,] -0.05152308 0.8731606 0.008853658</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,]  0.06155071 0.8297683 0.073817334</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,]  0.22650197 0.9404226 0.217721379</span>
<span class="r-in"><span>  <span class="co">## predict 0.025, 0.25, 0.5, 0.75, 0.975 Quantile at 0, 0.5 and 1</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">gsample</span>, doseSeq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>               0       0.5        1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 0.04759272 0.7076645 0.769421</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 0.26585613 0.8132222 0.904595</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 0.35469505 0.8794331 0.992379</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,] 0.44627453 0.9414073 1.083946</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,] 0.58765331 1.0659162 1.241633</span>
<span class="r-in"><span>  <span class="co">## simple plot function</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gsample</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="bFitMod-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## now look at bootstrap distribution</span></span></span>
<span class="r-in"><span>  <span class="va">gsample</span> <span class="op">&lt;-</span> <span class="fu">bFitMod</span><span class="op">(</span><span class="va">dose</span>, <span class="va">drFit</span>, <span class="va">S</span>, model <span class="op">=</span> <span class="st">"emax"</span>, type <span class="op">=</span> <span class="st">"bootstrap"</span>,</span></span>
<span class="r-in"><span>                     nSim <span class="op">=</span> <span class="fl">100</span>, bnds <span class="op">=</span> <span class="fu"><a href="defBnds.html">defBnds</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">emax</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">gsample</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="bFitMod-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## now fit linear interpolation</span></span></span>
<span class="r-in"><span>  <span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>norm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span><span class="op">)</span>, norm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                norm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span><span class="op">)</span>, norm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span><span class="op">)</span>, norm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">gsample</span> <span class="op">&lt;-</span> <span class="fu">bFitMod</span><span class="op">(</span><span class="va">dose</span>, <span class="va">drFit</span>, <span class="va">S</span>, model <span class="op">=</span> <span class="st">"linInt"</span>, </span></span>
<span class="r-in"><span>                     start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span>, nSim <span class="op">=</span> <span class="fl">1000</span>, prior <span class="op">=</span> <span class="va">prior</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">gsample</span> <span class="op">&lt;-</span> <span class="fu">bFitMod</span><span class="op">(</span><span class="va">dose</span>, <span class="va">drFit</span>, <span class="va">S</span>, model <span class="op">=</span> <span class="st">"linInt"</span>, type <span class="op">=</span> <span class="st">"bootstrap"</span>,</span></span>
<span class="r-in"><span>                     nSim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co">## data fitted on placebo adjusted scale</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">IBScovars</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">anovaMod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">resp</span><span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">dose</span><span class="op">)</span><span class="op">+</span><span class="va">gender</span>, data<span class="op">=</span><span class="va">IBScovars</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">drFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">anovaMod</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> <span class="co"># placebo adjusted estimates at doses</span></span></span>
<span class="r-in"><span>  <span class="va">vCov</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">anovaMod</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">dose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">IBScovars</span><span class="op">$</span><span class="va">dose</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>norm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span>, beta<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">6</span>,<span class="fl">0.45</span>,<span class="fl">1.7</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co">## Bayes fit</span></span></span>
<span class="r-in"><span>  <span class="va">gsample</span> <span class="op">&lt;-</span> <span class="fu">bFitMod</span><span class="op">(</span><span class="va">dose</span>, <span class="va">drFit</span>, <span class="va">vCov</span>, model <span class="op">=</span> <span class="st">"emax"</span>, placAdj<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                     start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>, nSim <span class="op">=</span> <span class="fl">1000</span>, prior <span class="op">=</span> <span class="va">prior</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co">## bootstrap fit</span></span></span>
<span class="r-in"><span>  <span class="va">gsample</span> <span class="op">&lt;-</span> <span class="fu">bFitMod</span><span class="op">(</span><span class="va">dose</span>, <span class="va">drFit</span>, <span class="va">vCov</span>, model <span class="op">=</span> <span class="st">"emax"</span>, placAdj<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                     type <span class="op">=</span> <span class="st">"bootstrap"</span>, start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0.1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     nSim <span class="op">=</span> <span class="fl">100</span>, prior <span class="op">=</span> <span class="va">prior</span>, bnds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>,<span class="fl">6</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="co">## calculate target dose estimate</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="targdose.html">TD</a></span><span class="op">(</span><span class="va">gsample</span>, Delta <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [1] 5.483246e-01           NA 2.082177e-02           NA 1.012294e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [6] 7.170960e+00 9.170305e-02 1.164439e+00 4.473308e-01 8.647422e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [11] 8.524866e-01 3.265359e-01 6.115726e-03 6.464406e-01 1.168766e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [16] 8.012687e-02 4.644101e-02 2.918858e-01 1.980985e-02 8.306477e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [21] 3.249893e+00 5.186899e-02 6.817803e+02           NA 3.955707e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [26] 1.173023e-02 1.762746e-02 1.609045e+00 3.311992e-01 1.252110e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [31] 1.046662e-02 3.420285e-02 3.278316e-01 7.190523e-01 1.830558e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [36] 4.315960e-01 6.644240e-01 4.524656e-01 2.626864e+00 9.839347e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [41] 8.395836e-01 8.418548e-01 9.022919e-01 3.124601e-01 4.169349e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [46] 1.878729e-02 1.573643e-01 2.584459e-01 1.086026e+00 2.016593e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [51] 1.142066e-01 1.245746e-02 5.157838e-02           NA 1.162715e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [56] 6.292261e-01 2.938004e-01 4.014124e-01 8.601197e+00 1.414026e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [61] 4.714891e-02           NA 2.442323e+00           NA 1.013448e-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [66] 1.678585e-01 1.624529e-02 9.736559e-01 9.079957e-01 2.013135e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [71] 5.200823e-01 3.835070e-01 2.728112e-02 6.631502e-01 2.449805e-02</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [76] 1.046263e+00 3.623976e-01 1.311963e+00 1.315941e+00           NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [81] 6.498328e-02 7.201673e+00 1.084076e-02 7.791422e-01 2.891102e+01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [86] 2.429044e+00 6.605563e-01 3.567867e-01 1.220284e-02 1.625772e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [91] 4.291899e-01 6.428695e-03 8.695904e-01 6.967239e-01 1.238257e+00</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [96] 2.416458e-01 3.849889e-01 8.106360e-01 1.399761e+00 1.162878e+00</span>
<span class="r-in"><span>  <span class="co">## now fit linear interpolation</span></span></span>
<span class="r-in"><span>  <span class="va">prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>norm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span><span class="op">)</span>, norm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span><span class="op">)</span>, norm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1000</span><span class="op">)</span>, norm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">100</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">gsample</span> <span class="op">&lt;-</span> <span class="fu">bFitMod</span><span class="op">(</span><span class="va">dose</span>, <span class="va">drFit</span>, <span class="va">vCov</span>, model <span class="op">=</span> <span class="st">"linInt"</span>, placAdj<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>                     start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span>, nSim <span class="op">=</span> <span class="fl">1000</span>, prior <span class="op">=</span> <span class="va">prior</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">gsample</span> <span class="op">&lt;-</span> <span class="fu">bFitMod</span><span class="op">(</span><span class="va">dose</span>, <span class="va">drFit</span>, <span class="va">vCov</span>, model <span class="op">=</span> <span class="st">"linInt"</span>, type <span class="op">=</span> <span class="st">"bootstrap"</span>,</span></span>
<span class="r-in"><span>                     placAdj <span class="op">=</span> <span class="cn">TRUE</span>, nSim <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bjoern Bornkamp, Jose Pinheiro, Frank Bretz, Ludger Sandig, Marius Thomas, Novartis Pharma AG.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

